# Jenkins + Ansible + Kubernetesì™€ì˜ ì—°ë™
## 1. Kubernetes ì†Œê°œ
### Container Virtualization
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/65c4527d-dd34-4aaa-b67a-4da30a0946e4" width="60%"/><br>
- Traditional Deployment
    - ì „í†µì ì¸ ë°©ë²•ì„ í†µí•´ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•œë‹¤ëŠ” ê²ƒ
    - ë¬¼ë¦¬ì ì¸ í•˜ë“œì›¨ì–´ ìœ„ì— ìš´ì˜ì²´ì œë¥¼ ì„¤ì¹˜í•˜ê³  í•„ìš”ë¡œí•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì„¤ì¹˜í•˜ëŠ” ë°©ì‹
    - í•˜ë‚˜ì˜ ë¬¼ë¦¬ì ì¸ ì„œë²„ê°€ ê°€ì§€ê³  ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì—¬ëŸ¬ê°€ì§€ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ê³µìœ í•˜ëŠ” ë°©ì‹ì´ë©°, íŠ¹ì • ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì ìœ í•œë‹¤ë©´ ë‹¤ë¥¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì´ ë–¨ì–´ì§
    - ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì„œë²„ ìì²´ë¥¼ ì—¬ëŸ¬ê°œ ë‘ë©´ ë¬¼ë¦¬ì ì¸ ì„œë²„ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ë§ì€ ë¹„ìš©ì´ ë“ ë‹¤.
- Virtualized Deployment
    - ì„œë²„ ê°€ìƒí™” ë°©ì‹
    - ë¬¼ë¦¬ì ì¸ í•˜ë“œì›¨ì–´ ìœ„ì— ìš´ì˜ì²´ì œë¥¼ ì„¤ì¹˜í•˜ê³ Â **Hypervisor**ë¼ëŠ” ê¸°ìˆ ì„ í†µí•´ì„œ ê°ê°ì˜ VMì— **ê°œë³„ì ì¸ ìš´ì˜ì²´ì œ**ë¥¼ ìš´ì˜í•  ìˆ˜ ìˆë‹¤.
      > ê°œë³„ì ì¸ ìš´ì˜ì²´ì œ ìš´ì˜ì´ë€?
      >
      > CPU, Memory, í”„ë¡œì„¸ìŠ¤ ë“± ê°ê°ì˜ VMê°„ì— ë…ë¦½ì ìœ¼ë¡œ ìš´ì˜í•˜ê¸° ë•Œë¬¸ì— VMì•ˆì— ì„¤ì¹˜ëœ ì–´í”Œë¦¬ì¼€ì´ì…˜ê°„ì— ì–´ëŠì •ë„ì˜ ë³´ì•ˆë„ ìœ ì§€ê°€ëŠ¥í•¨.
    
    - ì„œë²„ ê°€ìƒí™”ëŠ” ê²°êµ­ ë¬¼ë¦¬ì ì¸ í•˜ë“œì›¨ì–´ê°€ ê°€ì§„ ë¦¬ì†ŒìŠ¤ë¥¼ ìª¼ê°œì„œ ê°€ìƒí™”ì— ìˆëŠ” VMë“¤ì´ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ë¯€ë¡œ VMì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì„œë²„ì— ë¬´ë¦¬ê°€ ê°„ë‹¤.
- **Container Deployment**
    - VMê°€ ìœ ì‚¬í•˜ì§€ë§Œ ê²©ë¦¬í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•´ì„œ ì™„í™”, ì–´í”Œë¦¬ì¼€ì´ì…˜ê°„ì˜ ìš´ì˜ì²´ì œë¥¼ ê³µìœ í• ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ê°€ìƒí™” ê¸°ìˆ 
    - ìš´ì˜ì²´ì œì— í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì„œë¹„ìŠ¤ê°„ì— ê³µìœ í•¨ìœ¼ë¡œì¨ ì»¨í…Œì´ë„ˆ ê°€ìƒí™” ê¸°ìˆ ì€ ì„œë²„ ê°€ìƒí™” ê¸°ìˆ ì— ë¹„í•´ì„œ í›¨ì”¬ ê°€ë³ê²Œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ìš´ì˜í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
    - ê¸°ì¡´ ì¸í”„ë¼ì˜ ì¢…ì†ì„±ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆì—ˆìœ¼ë¯€ë¡œ ë‹¤ì–‘í•œ í´ë¼ìš°ë“œì— ì´ì‹í•˜ì—¬ ìš´ì˜ì´ ê°€ëŠ¥í•´ì¡Œë‹¤.

<br>

### Kubernetes
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/bf7acaf3-0380-4822-bf10-6b0ee54dcea8" width="60%"/><br>
- DockerëŠ” k8së¥¼ ëŒ€ì‹ í•  ìˆ˜ ì—†ê³ , k8sëŠ” Dockerë¥¼ ëŒ€ì‹ í•  ìˆ˜ ì—†ë‹¤.(ì„œë¡œ ë³´ì™„ì )
- ì˜¤í”ˆì†ŒìŠ¤ ê¸°ë°˜ì˜ ì»¨í…Œì´ë„ˆí™” ëœ ì• í”Œë¦¬ì¼€ì´ì…˜(ì›Œí¬ë¡œë“œì™€ ì„œë¹„ìŠ¤)ì˜ ìë™ ë°°í¬, ìŠ¤ì¼€ì¼ë§ ë“±ì„ ì œê³µí•˜ëŠ” ê´€ë¦¬ í”Œë«í¼
- ê°ê°ì˜ ì»¨í…Œì´ë„ˆë¥¼ ê´€ë¦¬í•´ì£¼ë©° ìŠ¤ì¼€ì¤„ë§í•´ì£¼ëŠ” ë„êµ¬
- Kubernetesë¥¼ í†µí•´ì„œ Dockerì— ë°°í¬ëœ ê²°ê³¼ë¬¼ì„ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ë¡œ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
- ì¥ì ê³¼ ë‹¨ì <br>
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a15b3e14-7800-4fb8-b0ee-7a56fd95d522" width="60%"/><br>

<br>

### Kubernetes Cluster
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b9ecd057-f022-4848-a972-79e8e79f6279" width="60%"/><br>
- ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì»¨í…Œì´ë„ˆë¥¼ Pod í˜•íƒœë¡œ ë¬¶ì–´ì„œ ì‚¬ìš©í•˜ëŠ”ê²ƒì´ ì¼ë°˜ì ì¸ í˜•íƒœ
- Dockerì˜ ì»¨í…Œì´ë„ˆ != Pod â†’ ì—¬ëŸ¬ê°€ì§€ ì»¨í…Œì´ë„ˆê°€ ë¬¶ì—¬ì„œ Podë¥¼ êµ¬ì„±í•œë‹¤.
- ê° ë…¸ë“œë“¤ì€ ì»¨í…Œì´ë„ˆë¥¼ ìš´ì˜í•˜ê¸° ìœ„í•œ ì»¨í…Œì´ë„ˆ ì—”ì§„(Docker)ì´ ì¡´ì¬í•´ì•¼ í•œë‹¤.

> CI/CD pipelineì„ í†µí•´ì„œ ê²°ê³¼ë¬¼ì„ ë°°í¬í•œë‹¤ëŠ” ì˜ë¯¸ëŠ” ì¼ë‹¨ ì»¨í…Œì´ë„ˆ í˜•íƒœë¡œ ë°°í¬í•  ê²ƒì¸ë° ê·¸ëŸ¬í•œ ì»¨í…Œì´ë„ˆëŠ” Podë¼ëŠ” ê²ƒìœ¼ë¡œ ê°ì‹¸ì„œ ë°°í¬<br>
> Podí˜•íƒœë¡œ ê°ì‹¸ì§„ ê²°ê³¼ë¬¼ì„ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„œë¹„ìŠ¤ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ë¶™ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒíƒœë¡œ ë§Œë“¤ì–´ì¤€ë‹¤.

- Pods: ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ ì„œë¡œ ìƒí˜¸ ì‘ìš©í•´ì•¼ í•˜ëŠ” ì»¨í…Œì´ë„ˆë“¤ì˜ ë…¼ë¦¬ì ì¸ ì§‘í•©
- Service: Replicated ëœ PODS ê·¸ë£¹ ê°„ì— ë¡œë“œ ë°¸ëŸ°ì‹±ì„ ì œê³µ

<br>

## 2. Kubernetes ì„¤ì¹˜
### Install Kubernetes Cluster
#### VMì„ ì´ìš©í•œ ë¦¬ëˆ…ìŠ¤ ì„¤ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a3b91f0d-84cb-4951-9f40-2306a5c4a81a" width="60%"/><br>
- masterë…¸ë“œì™€ workë…¸ë“œëŠ” ë¶„ë¦¬ë¥¼ ì‹œì¼œ ë†“ì€ ìƒíƒœì—ì„œ masterë…¸ë“œì—ì„œëŠ” ì‚¬ìš©ìê°€ ìš”ì²­í–ˆë˜ ëª…ë ¹ì„ ì²˜ë¦¬, workë…¸ë“œì—ì„œëŠ” ì‹¤ì œë¡œ ì»¨í…Œì´ë„ˆ ì‘ì—…ì„ ì§„í–‰
- ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ì´ë¼ë˜ê°€ ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ í•´ë‹¹í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì¬ê°€ìš©í•  ìˆ˜ ìˆë„ë¡ ë…¸ë“œ ìì²´ë„ í•˜ë‚˜ ì´ìƒ ì„¤ì¹˜í•˜ëŠ” ê²Œ ì¢‹ë‹¤.

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b845ff88-97fa-4383-9554-163b3bb4759d" width="60%"/><br>

<br>

### Install Minikube (ì‹±ê¸€ë…¸ë“œ)
#### Enable Kubernetes on Minikube
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/2fb10369-2f49-448a-8a40-102096700f60" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/9df3cb43-fd7c-4fca-9bf7-be61f6fef48a" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/6c89183e-0a28-4be0-8d68-ce0c10ea5a88" width="60%"/><br>

<br>

## 3. K8s ê¸°ë³¸ ëª…ë ¹ì–´
### ë…¸ë“œ í™•ì¸
```
kubectl get nodes
```
```
k8s % kubectl get nodes
NAME             STATUS   ROLES           AGE     VERSION
docker-desktop   Ready    control-plane   4m28s   v1.27.2
```
### Pod í™•ì¸
```
kubectl get pods
```
```
k8s % kubectl get pods
No resources found in default namespace.
```
> namespaceë€? <br>
> ê°€ìƒì˜ ë„¤íŠ¸ì›Œí¬, k8sì˜ ì˜¤ë¸Œì íŠ¸ë“¤ì´ ëª¨ì—¬ìˆëŠ” ê°€ìƒì˜ ê³µê°„
### Deployment í™•ì¸
```
kubectl get deployments
```
```
k8s % kubectl get deployments
No resources found in default namespace.
```
### Service í™•ì¸
```
kubectl get services
```
```
k8s % kubectl get services
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   14m
```
<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/ebc4b8c7-14ab-43c3-bd8d-2ba1013fee1d" width="60%"/><br>

<br>

### Nginx ì„œë²„ ì‹¤í–‰
#### kubectl ëª…ë ¹ì–´ë¥¼ í†µí•´ Nginxë¼ëŠ” ì›¹ì„œë²„ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ì•„ ì»¨í…Œì´ë„ˆ ë°©ì‹ìœ¼ë¡œ ê¸°ë™
```
kubectl run sample-nginx --image=nginx --port=80
```
- k8së¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì»¨í…Œì´ë„ˆê°€ ì´ë¯¸ ì‘ë™ ì¤‘ ì´ì–´ì•¼í•˜ë©° k8sì—ì„œ ê´€ë¦¬í•˜ê³ ìí•˜ëŠ” ìµœì†Œ ë‹¨ìœ„ëŠ” Pod
- Pod ë‚´ì—ëŠ” ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ì„œë¹„ìŠ¤, ë¯¸ë“¤ì›¨ì–´, ìš´ì˜ì²´ì œ, ì–´í”Œë¦¬ì¼€ì´ì…˜ ë“±ì´ ì»¨í…Œì´ë„ˆë¡œ íŒ¨í‚¤ì§•í™” ë˜ì–´ìˆì–´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒíƒœ
- ìœ„ì˜ ì˜ˆì œëŠ” nginxë¼ëŠ” ì›¹ì„œë²„ê°€ ì´ë¯¸ì§€í˜•íƒœë¡œ ì œê³µë˜ê³ ìˆëŠ”ë° í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ sample-nginxë¼ëŠ” Podë¡œ ìƒì„±í•˜ê² ë‹¤ëŠ” ëª…ë ¹ì–´
```
k8s % kubectl run sample-nginx --image=nginx --port=80
pod/sample-nginx created
```
```
k8s % kubectl get pods
NAME           READY   STATUS    RESTARTS   AGE
sample-nginx   1/1     Running   0          27m
```
### ì»¨í…Œì´ë„ˆ ì •ë³´ í™•ì¸
```
kubectl describe pod/sample-nginx
```
```
k8s % kubectl describe pod/sample-nginx
Name:             sample-nginx
Namespace:        default
Priority:         0
Service Account:  default
Node:             docker-desktop/192.168.65.4
Start Time:       Tue, 14 Nov 2023 02:44:38 +0900
Labels:           run=sample-nginx
Annotations:      <none>
Status:           Running
IP:               10.1.0.6
IPs:
  IP:  10.1.0.6
Containers:
  sample-nginx:
    Container ID:   docker://5b8a7bae4d66114081daf00e14d5701d8b8d8891460b5a941110b02d150224df
    Image:          nginx
    Image ID:       docker-pullable://nginx@sha256:86e53c4c16a6a276b204b0fd3a8143d86547c967dc8258b3d47c3a21bb68d3c6
    Port:           80/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Tue, 14 Nov 2023 02:44:50 +0900
    Ready:          True
    Restart Count:  0
    Environment:    <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-zf8mg (ro)
Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 
Volumes:
  kube-api-access-zf8mg:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   BestEffort
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age   From               Message
  ----    ------     ----  ----               -------
  Normal  Scheduled  30m   default-scheduler  Successfully assigned default/sample-nginx to docker-desktop
  Normal  Pulling    30m   kubelet            Pulling image "nginx"
  Normal  Pulled     30m   kubelet            Successfully pulled image "nginx" in 11.09339863s (11.093405047s including waiting)
  Normal  Created    30m   kubelet            Created container sample-nginx
  Normal  Started    30m   kubelet            Started container sample-nginx
```
### pod ì‚­ì œ
```
kubectl delete pod/sample-nginx-XXXXX-XXXXX
```
### ìœ„ì—ì„œ ì‹¤í–‰í•œ Nginxë¥¼ ì„¤ì¹˜
```
kubectl create deployment sample-nginx --image=nginx
```
- Deploymentë¼ëŠ” ê°œë…ì„ í†µí•´ì„œ ë°©ê¸ˆ ì‹¤í–‰í•œ nginxë¥¼ ì„¤ì¹˜
- Deployment : ê°€ì§€ê³  ìˆëŠ” podë¥¼ ì—¬ëŸ¬ê°œì˜ í˜•íƒœë¡œ ìŠ¤ì¼€ì¼ë§í•˜ê±°ë‚˜ ìŠ¤ì¼€ì¤„ë§ì‘ì—…, íˆìŠ¤í† ë¦¬ì‘ì—…ì„ í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì„¤ì¹˜ ê°œë…
- Deployment ì‹œ ìë™ìœ¼ë¡œ podê°€ ìƒì„±ë˜ê³  podë¥¼ ìƒì„±í•´ë„ ë‹¤ë¥¸ ì•„ì´ë””ë¥¼ ê°€ì§„ podê°€ ìë™ ìƒì„±ëœë‹¤.
- Deploymentë„ Podë¥¼ ë°°í¬í•˜ëŠ” ê°œë…
- podì˜ ìƒìœ„ ê°œë…ìœ¼ë¡œ ë°°í¬ ë‹¨ìœ„ë¥¼ deploymentë¡œ ê°ì‹¸ì„œ ë°°í¬í•˜ê²Œ ë˜ë©´ ìŠ¤ì¼€ì¼ë§, ìŠ¤ì¼€ì¤„ ì‘ì—…ì´ í¸í•´ì§„ë‹¤.
```
k8s % kubectl create deployment sample-nginx --image=nginx
deployment.apps/sample-nginx created
```
```
k8s % kubectl get deployments                             
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
sample-nginx   1/1     1            1           117s
```
```
k8s % kubectl get pods                                    
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-8gzxs   1/1     Running   0          2m50s
```
- Deloyment í˜•íƒœë¡œ Podê°€ ìƒì„±ë˜ë©´ ì´ë¦„ ë’¤ì— ëœë¤ ìˆ«ìê°€ ë°°ì •ëœë‹¤.
- ì¦‰, sample-nginx ë¼ëŠ” Deployment ì—ëŠ” Pod í•œê°œê°€ ë¬¶ì—¬ì„œ ì‹¤í–‰ë˜ê³  ìˆë‹¤.
```
k8s % kubectl get pods                                    
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-8gzxs   1/1     Running   0          2m50s
k8s % kubectl delete pod/sample-nginx-5d9d6f4fc4-8gzxs     
pod "sample-nginx-5d9d6f4fc4-8gzxs" deleted
k8s % kubectl get pods                                
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-l2n7t   1/1     Running   0          4s
```
- Deploy í˜•íƒœì˜ Podë¥¼ ì‚­ì œí•´ë„ ìƒˆë¡œìš´ ëœë¤ ìˆ«ìê°€ ë°°ì •ëœ Podê°€ ìƒì„±ëœë‹¤.
- Deplo í˜•íƒœë¡œ Podë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤ë©´ Deploymentì—ì„œ ìœ ì§€í•˜ë ¤ê³ í•˜ëŠ” ìµœì†Œí•œì˜ Pod ê°œìˆ˜ë¥¼ ê³„ì† ìœ ì§€í•´ì¤€ë‹¤.
- ë”°ë¼ì„œ Pod ê°€ ë¬¸ì œê°€ ìƒê²¨ì„œ ì •ìƒ ì‘ë™ì¤‘ì´ì§€ ì•Šì„ ê²½ìš°ì— ë°˜ë“œì‹œ ìµœì†Œí•œì˜ pod ê°œìˆ˜ë¥¼ ìœ ì§€í•˜ë ¤ëŠ” ì†ì„±ì„ ê°€ì§„ë‹¤.
- ê·¸ë˜ì„œ Deploymentë¥¼ Kubernetesì—ì„œ pod ë‹¨ìœ„ë¡œ ë°°í¬í•  ë•Œ ë§ì´ ì‚¬ìš©ëœë‹¤.
```
k8s % kubectl get deployments                         
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
sample-nginx   1/1     1            1           28m
k8s % kubectl get pods       
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-l2n7t   1/1     Running   0          6m44s
```
### Scale ë³€ê²½ (2ê°œë¡œ ë³€ê²½)
```
kubectl scale deployment sample-nginx --replicas=2
```
- sample-nginx ì—ì„œ ìœ ì§€í•˜ë ¤ê³  í•˜ëŠ” Pod ê°œìˆ˜ë¥¼ 2ê°œë¡œ ì§€ì •í•˜ëŠ” ê²ƒ
```
k8s % kubectl scale deployment sample-nginx --replicas=2
deployment.apps/sample-nginx scaled
k8s % kubectl get pods                                  
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-l2n7t   1/1     Running   0          7h27m
sample-nginx-5d9d6f4fc4-mhvx8   1/1     Running   0          3m6s
k8s % kubectl get deployments                           
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
sample-nginx   2/2     2            2           7h50m
```
- READY : í˜„ì¬ podì•ˆì— ì „ì²´ ì»¨í…Œì´ë„ˆ ê°œìˆ˜ì™€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ì»¨í…Œì´ë„ˆ ê°œìˆ˜
### Scale ë³€ê²½ (1ê°œë¡œ ë³€ê²½)
```
kubectl scale deployment sample-nginx --replicas=1
```
```
k8s % kubectl scale deployment sample-nginx --replicas=1
deployment.apps/sample-nginx scaled
k8s % kubectl get pods                                  
NAME                            READY   STATUS    RESTARTS   AGE
sample-nginx-5d9d6f4fc4-l2n7t   1/1     Running   0          7h35m
k8s % kubectl get deployments                           
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
sample-nginx   1/1     1            1           7h57m
k8s % kubectl delete deployment.apps/sample-nginx
deployment.apps "sample-nginx" deleted
k8s % kubectl get deployments
No resources found in default namespace.
```
### Script ì‹¤í–‰ (ìœ„ì˜ ë‚´ìš©ì„ Scriptí™”í•˜ì—¬ ì‹¤í–‰) - ê°€ì¥ ë§ì´ ì‚¬ìš©ë¨â­ï¸
```
kubectl apply -f sample1.yml
```
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
```
- apiVersion: ì–´ë–¤ ì˜¤ë¸Œì íŠ¸(Pod, Service, Deployment)ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì§€ë§Œ apps/v1ì´ ê±°ì˜ ê³ ì •ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.
    - Pod, Service, Deployment -> apps/v1
- kind: ë§Œë“¤ê³ ìí•˜ëŠ” k8s ì˜¤ë¸Œì íŠ¸ê°€ Pod? Deployment? Service? Replica-Set?
- metadata: ìŠ¤í¬ë¦½íŠ¸ì˜ ë ˆì´ë¸”ë§
    - labels : key, value í˜•íƒœ
- spec
    - kind ì— ë”°ë¼ì„œ ë‹¬ë¼ì§€ëŠ” ì •ë³´
    - ì˜ˆë¥¼ ë“¤ì–´, Pod ì¸ ê²½ìš°ì—ëŠ” Podì— í¬í•¨ë  ì»¨í…Œì´ë„ˆ ì´ë¦„, Deploymentì¸ ê²½ìš° Deploymentì— í•„ìš”í•œ ì˜µì…˜ ì •ë¦¬
    - í˜„ì¬ Deployment ì´ë¯€ë¡œ Deploymentì˜ ì •ë³´ë¥¼ ë‹´ì€ ê²ƒì´ë‹¤.
    - replicas :2 : podì˜ ê°œìˆ˜ 2ê°œë¡œ ìœ ì§€
    - selector: ëŒ€ìƒ ì •ë³´, ì‘ì—…í•˜ë ¤ëŠ” ëŒ€ìƒì„ ì–´ë–¤ Labelì— ëª…ì‹œí• ì§€ ê³ ë¥¸ë‹¤.
    - template: ì‹¤ì œ Deploymentë¥¼ í†µí•´ì„œ ì„¤ì¹˜í•˜ë ¤ëŠ” Podì˜ ë‚´ìš©
```
k8s % ls sample1.yml
sample1.yml
k8s % kubectl apply -f sample1.yml
deployment.apps/nginx-deployment created
k8s % kubectl get deployments                    
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
nginx-deployment   2/2     2            2           58s
k8s % kubectl get pods            
NAME                               READY   STATUS    RESTARTS   AGE
nginx-deployment-cbdccf466-5cqbk   1/1     Running   0          109s
nginx-deployment-cbdccf466-jbmgp   1/1     Running   0          109s
```

<br>

## 4. Kubernetes Script íŒŒì¼
### k8s ê¸°ë³¸ ëª…ë ¹ì–´
#### Pod ìƒì„¸ í™•ì¸
```
kubectl get pod -o wide
```
```
k8s % kubectl get pod -o wide
NAME                               READY   STATUS    RESTARTS   AGE   IP          NODE             NOMINATED NODE   READINESS GATES
nginx-deployment-cbdccf466-5cqbk   1/1     Running   0          35m   10.1.0.11   docker-desktop   <none>           <none>
nginx-deployment-cbdccf466-jbmgp   1/1     Running   0          35m   10.1.0.10   docker-desktop   <none>           <none>
```
#### Pod ì— í„°ë„ë§ìœ¼ë¡œ ì ‘ì†
```
kubectl exec -it nginx-deployment-XXXX-XXXX -- /bin/bash
```
```
root@nginx-deployment-cbdccf466-5cqbk:/# exit
exit
command terminated with exit code 127
k8s % kubectl get pod -o wide
NAME                               READY   STATUS    RESTARTS   AGE    IP          NODE             NOMINATED NODE   READINESS GATES
nginx-deployment-cbdccf466-5cqbk   1/1     Running   0          3h8m   10.1.0.11   docker-desktop   <none>           <none>
nginx-deployment-cbdccf466-jbmgp   1/1     Running   0          3h8m   10.1.0.10   docker-desktop   <none>           <none>
k8s % kubectl get services                                          
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   13h
```
#### í˜„ì¬ Pod ê°€ ì‚¬ìš©í•˜ê³  ìˆëŠ” Portë¥¼ ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í˜•íƒœ(Service)ë¡œ ì˜¤í”ˆ
```
kubectl expose deployment nginx-deployment --port=80 --type=NodePort
```
```
k8s % kubectl expose deployment nginx-deployment --port=80 --type=NodePort
service/nginx-deployment exposed
k8s % kubectl get services                                                
NAME               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
kubernetes         ClusterIP   10.96.0.1        <none>        443/TCP        13h
nginx-deployment   NodePort    10.108.157.222   <none>        80:30968/TCP   34s
```
ì™¸ë¶€ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œí•˜ë©´ service ê°€ ìƒì„±ëœë‹¤.

- 80:31464 â†’ **80**: nginx ë‚´ë¶€ í¬íŠ¸, **30968**: ì™¸ë¶€ í¬íŠ¸
- ì•ìª½ì— ìˆëŠ” í¬íŠ¸(80)ëŠ” ì»¨í…Œì´ë„ˆ, íŒŒë“œê°€ ê°€ì§€ê³  ìˆëŠ” í¬íŠ¸
- ë’¤ìª½ì— ìˆëŠ” í¬íŠ¸(30968)ëŠ” í¬ì›Œë”©ëœ í¬íŠ¸, host PC(macOS)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ ë²ˆí˜¸

    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/63cc3f04-b2a3-4ff9-ab4c-6d716823bf47" width="40%"/><br>

#### Pod ì‚­ì œ
```
kubectl delete pod/nginx-deployment-XXXX-XXXX
```
#### Deployment ì‚­ì œ
```
kubectl delete deployment nginx-deployment
```
#### ìœ„ì˜ ì‘ì—…ì„ scriptí™” - cicd-devops-deployment.yml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cicd-deployment
spec:
  selector:
    matchLabels:
      app: cicd-devops-project
  replicas: 2

  template:
    metadata:
      labels:
        app: cicd-devops-project
    spec:
      containers: # Section2,3ì—ì„œ ì‚¬ìš©í•œ ì»¨í…Œì´ë„ˆ
      - name: cicd-devops-project
        image: won1110218/cicd-project-ansible
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
```
- docker hubì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ì•„ì™€ì„œ k8s í™˜ê²½ì— ê¸°ë™í•  ê²ƒì´ë‹¤.
#### ìœ„ì˜ ì‘ì—…ì„ scriptí™” - cicd-devops-service.yml
```
k8s % kubectl get services
NAME               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
kubernetes         ClusterIP   10.96.0.1        <none>        443/TCP        13h
nginx-deployment   NodePort    10.108.157.222   <none>        80:30968/TCP   29m
k8s % kubectl delete service/nginx-deployment
service "nginx-deployment" deleted
k8s % kubectl get services                   
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   13h
```
```yaml
apiVersion: v1
kind: Service
metadata:
  name: cicd-service
  labels:
    app: cicd-devops-project
spec:
  selector:
    app: cicd-devops-project
  type: NodePort
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 32000
```
- Deployment ë¥¼ ì‘ë™(ì™¸ë¶€ì— ê³µê°œ)í•˜ê¸° ìœ„í•´ì„œ ì‘ì„±í•˜ëŠ” yml íŒŒì¼
- ì„œë¹„ìŠ¤ëŠ” ì™¸ë¶€ì˜ íŠ¹ì •í•œ í¬íŠ¸ë¥¼ ê³µê°œí•˜ëŠ” ëª©ì ìœ¼ë¡œ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.
- ì»¨í…Œì´ë„ˆê°€ ê°€ì§„ 8080í¬íŠ¸ë¥¼ ì™¸ë¶€ì— 8080ìœ¼ë¡œ ê³µê°œí•˜ê² ë‹¤.
- ì‹¤ì œ nodePort ì‚¬ìš©í•  ë•ŒëŠ” 32000ìœ¼ë¡œ ì ‘ì†
```
k8s % ls -al cicd*
-rw-r--r--@ 1 choihyewon  staff  419 11 14 15:41 cicd-devops-deployment.yml
-rw-r--r--@ 1 choihyewon  staff  240 11 14 11:57 cicd-devops-service.yml
```
#### ì‹¤í–‰
```
kubectl apply -f cicd-devops-deployment.yml
kubectl apply -f cicd-devops-service.yml
```
#### ê²°ê³¼
```
k8s % kubectl apply -f cicd-devops-deployment.yml
deployment.apps/cicd-deployment created
k8s % kubectl get deployment         
NAME              READY   UP-TO-DATE   AVAILABLE   AGE
cicd-deployment   0/2     2            0           10s - ì´ë¯¸ì§€ ì•„ì§ ë‹¤ìš´ë¡œë“œê°€...
k8s % kubectl get deployment  
NAME              READY   UP-TO-DATE   AVAILABLE   AGE
cicd-deployment   2/2     2            2           3m20s
k8s % kubectl apply -f cicd-devops-service.yml
service/cicd-service created
k8s % kubectl get services
NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
cicd-service   NodePort    10.107.17.43   <none>        8080:32000/TCP   15s
kubernetes     ClusterIP   10.96.0.1      <none>        443/TCP          13h
```
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/dac2b9eb-8763-4cea-9e97-6af4c7b27565" width="40%"/><br>

<br>

## 5. Kubernetes + Ansible ì—°ë™
### Ansibleì—ì„œ Kubernetes ì œì–´í•˜ê¸°
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e240ae63-81df-4187-aa96-c4e2ccaea680" width="60%"/><br>
- Docker ì»¨í…Œì´ë„ˆ ìš´ì˜ì¤‘ì¸ Ansibleì—ì„œ k8së¡œ ì ‘ì†í•˜ì—¬ Ansibleì˜ playbookì„ í†µí•´ k8sê°€ ê°€ì§„ ymlíŒŒì¼ì„ ì‹¤í–‰í•  ê²ƒì´ë‹¤.
- hosts íŒŒì¼ì— kubernetes ê·¸ë£¹ ì¶”ê°€

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b1bec22c-ad68-4002-b6fa-5959bba4a288" width="60%"/><br>
- ì´í›„ì—ëŠ” Jenkinsì—ì„œ Ansibleì— ëª…ë ¹ì„ ì „ë‹¬í•˜ë©´ Ansibleì—ì„œ playbookíŒŒì¼ì„ í†µí•´ k8sì— í•„ìš”í•œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤.
- ë˜ëŠ” Jenkinsì—ì„œ k8së¡œ ì§ì ‘ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ë„ ìˆë‹¤.

<br>

#### ğŸ“Ansible-server) k8s-master ì ‘ì† í…ŒìŠ¤íŠ¸
```
choihyewon@choehyewon-ui-noteubug k8s % docker ps -a
CONTAINER ID   IMAGE                             COMMAND                   CREATED        STATUS                   PORTS                                              NAMES
5e26d814b811   won1110218/cicd-project-ansible   "catalina.sh run"         4 hours ago    Up 4 hours                                                                  k8s_cicd-devops-project_cicd-deployment-5cb6bf89ff-g5k8h_default_bcf8bf9a-e2e6-463f-b8e0-b7a42d3771a0_0
a9925a1b297c   won1110218/cicd-project-ansible   "catalina.sh run"         4 hours ago    Up 4 hours                                                                  k8s_cicd-devops-project_cicd-deployment-5cb6bf89ff-6dnkd_default_b793b900-74cf-4373-a98c-9cffc2e5abe7_0
2eeaea95148d   registry.k8s.io/pause:3.9         "/pause"                  4 hours ago    Up 4 hours                                                                  k8s_POD_cicd-deployment-5cb6bf89ff-6dnkd_default_b793b900-74cf-4373-a98c-9cffc2e5abe7_0
41a89c463deb   registry.k8s.io/pause:3.9         "/pause"                  4 hours ago    Up 4 hours                                                                  k8s_POD_cicd-deployment-5cb6bf89ff-g5k8h_default_bcf8bf9a-e2e6-463f-b8e0-b7a42d3771a0_0
2eb531852514   3750dfec169f                      "/kube-vpnkit-forwarâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_vpnkit-controller_vpnkit-controller_kube-system_dc6431ca-a869-4e23-bde8-50631c64348f_0
54cef83d53ce   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_vpnkit-controller_kube-system_dc6431ca-a869-4e23-bde8-50631c64348f_0
7069150e8d4b   c027a58fa0bb                      "/storage-provisioneâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_storage-provisioner_storage-provisioner_kube-system_478f8146-ae5a-430d-b1d9-2cb1781cfbea_0
c42ed001236b   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_storage-provisioner_kube-system_478f8146-ae5a-430d-b1d9-2cb1781cfbea_0
19ad5a1a6064   97e04611ad43                      "/coredns -conf /etcâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_coredns_coredns-5d78c9869d-bctzp_kube-system_9d269b73-dd8d-47ed-a65d-afcd1bed0830_0
a9f221906639   97e04611ad43                      "/coredns -conf /etcâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_coredns_coredns-5d78c9869d-th6nw_kube-system_04b8c6a7-f6fa-432a-b476-3c2f9d09398f_0
105a079ff856   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_coredns-5d78c9869d-bctzp_kube-system_9d269b73-dd8d-47ed-a65d-afcd1bed0830_0
00fbcb464c73   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_coredns-5d78c9869d-th6nw_kube-system_04b8c6a7-f6fa-432a-b476-3c2f9d09398f_0
2bbb153e9f11   29921a084542                      "/usr/local/bin/kubeâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_kube-proxy_kube-proxy-5tgdh_kube-system_ddad1884-f586-4f15-b5aa-9fde0d316970_0
735dfdc58f14   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_kube-proxy-5tgdh_kube-system_ddad1884-f586-4f15-b5aa-9fde0d316970_0
b203024ce1f9   305d7ed1dae2                      "kube-scheduler --auâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_kube-scheduler_kube-scheduler-docker-desktop_kube-system_458a31e42f7d01ae485acb25e3254451_0
7a54b183df7b   2ee705380c3c                      "kube-controller-manâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_kube-controller-manager_kube-controller-manager-docker-desktop_kube-system_6d2a77df9cc3ca29a2153e8e119160ab_0
f0950108fe1f   24bc64e91103                      "etcd --advertise-clâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_etcd_etcd-docker-desktop_kube-system_a652e9966ea47b54b0275eed498b1cab_0
ff7b5a3de7fe   72c9df6be7f1                      "kube-apiserver --adâ€¦"   17 hours ago   Up 17 hours                                                                 k8s_kube-apiserver_kube-apiserver-docker-desktop_kube-system_2c5ac5deb80203a34d3d0ae47868dbee_0
d60e61832235   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_etcd-docker-desktop_kube-system_a652e9966ea47b54b0275eed498b1cab_0
49b77923f64e   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_kube-scheduler-docker-desktop_kube-system_458a31e42f7d01ae485acb25e3254451_0
082db0dee11a   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_kube-controller-manager-docker-desktop_kube-system_6d2a77df9cc3ca29a2153e8e119160ab_0
0c306cf266d5   registry.k8s.io/pause:3.9         "/pause"                  17 hours ago   Up 17 hours                                                                 k8s_POD_kube-apiserver-docker-desktop_kube-system_2c5ac5deb80203a34d3d0ae47868dbee_0
b2b74aa4e31b   edowon0623/ansible-server:m1      "/sbin/init systemctâ€¦"   5 days ago     Up 26 hours              0.0.0.0:20022->22/tcp, 0.0.0.0:8082->8080/tcp      ansible-server
c6caaa1f3878   edowon0623/docker-server:m1       "/sbin/init systemctâ€¦"   6 days ago     Up 30 hours              0.0.0.0:10022->22/tcp, 0.0.0.0:8081->8080/tcp      docker-server
67df6243d635   jenkins/jenkins:lts-jdk17         "/usr/bin/tini -- /uâ€¦"   10 days ago    Up 30 hours              0.0.0.0:8080->8080/tcp, 0.0.0.0:50000->50000/tcp   jenkins-server
92c4fd45f228   postgres                          "docker-entrypoint.sâ€¦"   3 months ago   Exited (0) 10 days ago                                                      postgres_boot
```
```
choihyewon@choehyewon-ui-noteubug k8s % docker ps -a | grep ansible
5e26d814b811   won1110218/cicd-project-ansible   "catalina.sh run"         4 hours ago    Up 4 hours                                                                  k8s_cicd-devops-project_cicd-deployment-5cb6bf89ff-g5k8h_default_bcf8bf9a-e2e6-463f-b8e0-b7a42d3771a0_0
a9925a1b297c   won1110218/cicd-project-ansible   "catalina.sh run"         4 hours ago    Up 4 hours                                                                  k8s_cicd-devops-project_cicd-deployment-5cb6bf89ff-6dnkd_default_b793b900-74cf-4373-a98c-9cffc2e5abe7_0
b2b74aa4e31b   edowon0623/ansible-server:m1      "/sbin/init systemctâ€¦"   5 days ago     Up 26 hours              0.0.0.0:20022->22/tcp, 0.0.0.0:8082->8080/tcp      ansible-server
choihyewon@choehyewon-ui-noteubug k8s % docker ps -a | grep ansible-server
b2b74aa4e31b   edowon0623/ansible-server:m1      "/sbin/init systemctâ€¦"   5 days ago     Up 26 hours              0.0.0.0:20022->22/tcp, 0.0.0.0:8082->8080/tcp      ansible-server
choihyewon@choehyewon-ui-noteubug k8s % docker exec -it ansible-server bash (ì ‘ì†)
[root@b2b74aa4e31b ~]# (b2b74aa4e31b = ì»¨í…Œì´ë„ˆ id = ansible ì„œë²„)
```

<br>

#### ğŸ“Ansible Server) k8s/hosts íŒŒì¼ ìƒì„±
```
[root@b2b74aa4e31b ~]# mkdir k8s
[root@b2b74aa4e31b ~]# cd k8s
[root@b2b74aa4e31b k8s]# vi hosts
```
- hostíŒŒì¼ì€ inventory íŒŒì¼ë¡œì„œ ansible ì„œë²„ì—ì„œ ì ‘ì†í•˜ë ¤ê³  í•˜ëŠ” ì„œë²„ë“¤ì˜ ì£¼ì†Œë¥¼ ì ëŠ” íŒŒì¼
```
[ansible-server]
localhost

[kubernetes]
ip ì£¼ì†Œ
```


<br>

#### ğŸ“Ping Test
```
ansible -i ./k8s/hosts kubernetes -m ping
```
```
[root@b2b74aa4e31b ~]# mkdir k8s
[root@b2b74aa4e31b ~]# cd k8s
[root@b2b74aa4e31b k8s]# vi hosts
[root@b2b74aa4e31b k8s]# cd ..
[root@b2b74aa4e31b ~]# ansible -i ./k8s/hosts kubernetes -m ping
[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv
to see details
192.168.35.31 | UNREACHABLE! => {
    "changed": false,
    "msg": "Failed to connect to the host via ssh: root@192.168.35.31: Permission denied (publickey,password,keyboard-interactive).",
    "unreachable": true
}
```
- **kubernetes :** hostíŒŒì¼ì—ì„œ **ì ìš©ì‹œí‚¬ í•­ëª©**
- **Permission denied :** Ansible Serverì—ì„œ k8s ì„œë²„(host PC)ì— íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì´ë‹¤.
- ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ í‚¤ê°’ì„ k8s ì„œë²„ì— ë³µì‚¬

<br>

#### ğŸ“Ansible Server) ssh-keygen, ssh-copy-id

<br>

## 6. Ansible Playbookìœ¼ë¡œ Kubernetes Script ì‹¤í–‰í•˜ê¸°
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/438e98b5-aff3-4679-917e-b184c477bb70" width="60%"/><br>

### **Ansible Server) create a playbook file for deployment - k8s-cicd-deployment-playbook.yml**
Ansibleì—ì„œ Playbook íŒŒì¼ì„ ì‹¤í–‰í•˜ì—¬ k8sì˜ ê°ê°ì˜ ë…¸ë“œê°€ íŒŒì¼ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ k8sì— í•„ìš”í•œ script ìƒì„±
```yaml
- name: Create pods using deployment
  hosts: kubernetes #ì ìš©í•˜ê³ ì í•˜ëŠ” host(kubernetes ê·¸ë£¹) ì§€ì •
  # become: true
  # user: ubuntu

  tasks:
  - name: delete the previous deployment
    command: kubectl delete deployment.apps/cicd-deployment
    ignore_errors: yes

  - name: create a deployment
    command: kubectl apply -f cicd-devops-deployment.yml
```
```
[root@b2b74aa4e31b ~]# vi k8s-cicd-deployment-playbook.yml
[root@b2b74aa4e31b ~]# ls -al k8s-cicd-deployment-playbook.yml
-rw-r--r-- 1 root root 294 Nov 14 14:04 k8s-cicd-deployment-playbook.yml
[root@b2b74aa4e31b ~]# cat k8s-cicd-deployment-playbook.yml
- name: Create pods using deployment 
  hosts: kubernetes 
  # become: true
  # user: ubuntu
 
  tasks: 
  - name: delete the previous deployment
    command: kubectl delete deployment.apps/cicd-deployment

  - name: create a deployment
    command: kubectl apply -f cicd-devops-deployment.yml
```

<br>

### **k8s Master) create a deployment yaml file - cicd-devops-deployment.yml**
k8sì—ì„œ deploymentë¼ë˜ê°€ service, podë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: cicd-deployment
spec:
  selector:
    matchLabels:
      app: cicd-devops-project
  replicas: 2

  template:
    metadata:
      labels:
        app: cicd-devops-project
    spec:
      containers:
      - name: cicd-devops-project
        image: won1110218/cicd-project-ansible
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
```

- sshë¡œ ì²«ë²ˆì§¸ ì ‘ì†ì„ í–ˆì„ ë•Œ ë³´ì´ëŠ” í´ë”ê°€ home ë””ë ‰í† ë¦¬ì¸ë°, ì´ home ë””ë ‰í† ë¦¬ì— cicd-devops -deployment.yml íŒŒì¼ ìƒì„±í•˜ê¸°(homeë””ë ‰í„°ë¦¬ì— ìˆì–´ì•¼ í•¨)

<br>

### Ansible Server) execute a playbook file(for deployment)
```
ansible-playbook -i ./k8s/hosts k8s-cicd-deployment-playbook.yml
```
- ì´ íŒŒì¼ì—ì„œ ê²°êµ­ ì‹¤í–‰í•˜ë ¤ëŠ” ê²ƒ â†’ **kubectl apply** -f cicd-devops-deployment.yml
- k8sê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” pcì— ê°€ì„œ ëª…ë ¹ì–´ê°€ ì „ë‹¬ì´ ë¼ì„œ ì‹¤í–‰ì´ ë  ê²ƒ

<br>

### Ansible Server) create a playbook file for service - k8s-cicd-service-playbook.yml
```yaml
- name: create service for deployment
  hosts: kubernetes
  # become: true
  # user: ubuntu
  tasks:
    - name: delete the previous service
      command: kubectl delete service/cicd-service
      ignore_errors: yes

    - name: create a service
      command: kubectl apply -f cicd-devops-service.yml
```

<br>

### k8s Master) create a service yaml file - cicd-devops-service.yml
```yaml
apiVersion: v1
kind: Service
metadata:
  name: cicd-service
  labels:
    app: cicd-devops-project
spec:
  selector:
    app: cicd-devops-project
  type: NodePort
  ports:
    - port: 8080
      targetPort: 8080
      nodePort: 32000
```

<br>

### Ansible Server) execute a playbook file(for service)
```
ansible-playbook -i ./k8s/hosts k8s-cicd-service-playbook.yml -u choihyewon
```

<br>

## 7. Jenkins + Ansible + Kubernetes ì—°ë™í•˜ê¸°
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/c3d84548-01d7-4685-8726-0a3f6ea71c0a" width="60%"/><br>
### Setup Ansible on Jenkins
#### Jenkins ê´€ë¦¬ -> ì‹œìŠ¤í…œ ì„¤ì • -> Publish over SSH
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e0d7ea88-98ba-4fe2-a3ae-627a3838cf5a" width="60%"/><br>

<br>

### ìƒˆë¡œìš´ ì•„ì´í…œ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/c531708a-7cff-4355-b09f-a958200864fa" width="60%"/><br>

<br>

### ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/054475fb-4b81-4a11-a10f-a0928bbce703" width="60%"/><br>
- Build Triggers - SSH Server: k8s-master
- waríŒŒì¼ ë³µì‚¬
- Exec command
```
kubectl apply -f cicd-devops-deployment.yml
```
```
/usr/local/bin/kubectl apply -f /Users/choihyewon/cicd-devops-deployment.yml
```

<br>

### ë¹Œë“œ
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/65b42e8c-7938-45af-9f37-66815bf62324" width="40%"/><br>

<br>

### ansibleì´ ê°€ì§€ê³  ìˆëŠ” playbook íŒŒì¼ì—ì„œ ë™ì¼í•œ ì‘ì—… ì²˜ë¦¬
#### ìƒˆë¡œìš´ ì•„ì´í…œ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/ff6eec78-77ec-49a9-95a9-36c744f65f28" width="60%"/><br>
- Item name - My-k8s-Project-using-Ansible

<br>

#### ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/efd39498-ee5d-43b2-b06b-8838e2f43426" width="60%"/><br>
- Build Triggers - SSH Server: ansible-server
- Exec command
  ```
  ansible-playbook -i ./k8s/hosts k8s-cicd-deployment-playbook.yml -u choihyewon
  ```
- Append exec command
  ```
  ansible-playbook -i ./k8s/hosts k8s-cicd-deployment-playbook.yml -u choihyewon
  ansible-playbook -i ./k8s/hosts k8s-cicd-service-playbook.yml -u choihyewon
  ```
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a7b3a518-f517-46d2-93a2-a518f9bd9734" width="60%"/><br>

<br>

#### ë¹Œë“œ
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/516eebd1-6008-44ff-81e5-a1ec09638dfd" width="60%"/><br>

<br>

### ğŸ“Œ ì‹¤ìŠµ
#### k8s
```
 ~ % docker ps -a | grep jenkins-server
67df6243d635   jenkins/jenkins:lts-jdk17  "/usr/bin/tini -- /uâ€¦"   11 days ago  Up 2 days  0.0.0.0:8080->8080/tcp, 0.0.0.0:50000->50000/tcp   jenkins-server
```
```
choihyewon@choehyewon-ui-noteubug ~ % ls -al /usr/local/bin/kubectl
lrwxr-xr-x@ 1 root  wheel  55  7 27 11:50 /usr/local/bin/kubectl -> /Applications/Docker.app/Contents/Resources/bin/kubectl
```
```
~ % ls -al cicd-*
-rw-r--r--@ 1 choihyewon  staff  419 11 15 15:27 cicd-devops-deployment.yml
-rw-r--r--@ 1 choihyewon  staff  240 11 15 15:27 cicd-devops-service.yml
~ % pwd
/Users/choihyewon
```
â€”-jenkins ë¹Œë“œâ€”â€”â€”â€”â€”â€”> ì„±ê³µ <br>

```
~ % kubectl get all
NAME                                   READY   STATUS    RESTARTS   AGE
pod/cicd-deployment-5cb6bf89ff-9qm7m   1/1     Running   0          91m
pod/cicd-deployment-5cb6bf89ff-tj4nj   1/1     Running   0          91m

NAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/cicd-service   NodePort    10.99.140.217   <none>        8080:32000/TCP   175m
service/kubernetes     ClusterIP   10.96.0.1       <none>        443/TCP          40h

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/cicd-deployment   2/2     2            2           91m

NAME                                         DESIRED   CURRENT   READY   AGE
replicaset.apps/cicd-deployment-5cb6bf89ff   2         2         2       91m
```
```
~ % kubectl delete deployment.apps/cicd-deployment
deployment.apps "cicd-deployment" deleted
~ % kubectl delete service/cicd-service           
service "cicd-service" deleted
~ % kubectl get all                               
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   40h
```
- ì‚­ì œí•˜ê³  ë‹¤ì‹œí•´ë³´ê¸°
```
choihyewon@choehyewon-ui-noteubug ~ % kubectl get all
NAME                                   READY   STATUS    RESTARTS   AGE
pod/cicd-deployment-5cb6bf89ff-mpw4p   1/1     Running   0          22s
pod/cicd-deployment-5cb6bf89ff-t9b2z   1/1     Running   0          22s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   40h

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/cicd-deployment   2/2     2            2           22s

NAME                                         DESIRED   CURRENT   READY   AGE
replicaset.apps/cicd-deployment-5cb6bf89ff   2         2         2       22s
```

<br>

> ğŸ§‘ğŸ»â€ğŸ« jenkinsì—ì„œ ansibleì„ í†µí•´ì„œ k8sì— ì ‘ì† í…ŒìŠ¤íŠ¸

```
ansible-playbook -i ./k8s/hosts k8s-cicd-deployment-playbook.yml -u choihyewon
```
jenkinsë¹Œë“œâ€”â€”>ì„±ê³µ<br>
```
~ % kubectl get all
NAME                                   READY   STATUS              RESTARTS   AGE
pod/cicd-deployment-5cb6bf89ff-rr8xk   1/1     Running             0          4s
pod/cicd-deployment-5cb6bf89ff-swmld   0/1     ContainerCreating   0          4s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   10.96.0.1    <none>        443/TCP   40h

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/cicd-deployment   1/2     2            1           4s

NAME                                         DESIRED   CURRENT   READY   AGE
replicaset.apps/cicd-deployment-5cb6bf89ff   2         2         1       4s
```
```
~ % docker network inspect bridge
[
    {
        "Name": "bridge",
        "Id": "2d68d463d7d48d0f9ff8cbecdbe1fb28fc884b41ce200725d27a6f646123c2ac",
        "Created": "2023-11-13T02:53:50.936201083Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "67df6243d6351c58a100eda103e4efe8fa2a868fbc5c7a556281ff6cb9c75811": {
                "Name": "jenkins-server",
                "EndpointID": "cf2042feb5012efcc6db5aa9059acb53ec6b302af30f820268c2f84ed07d68d8",
                "MacAddress": "02:42:ac:11:00:03",
                "IPv4Address": "172.17.0.3/16",
                "IPv6Address": ""
            },
            "746ec15e9729d14d56f1c168b9d77de407130367fbaa1373edf547ed95f8823e": {
                "Name": "laughing_keldysh",
                "EndpointID": "8c19052d00abff1138929af21a165dec7fd9df191417fb45b07c11466f35c9e6",
                "MacAddress": "02:42:ac:11:00:06",
                "IPv4Address": "172.17.0.6/16",
                "IPv6Address": ""
            },
            "b2b74aa4e31b70897cb042cb12a4e7efac91c495703509034494587d11f7f093": {
                "Name": "ansible-server",
                "EndpointID": "fd8922d554bf832d81dca2825c99908429708547ff209f90d76cf5c6b96de468",
                "MacAddress": "02:42:ac:11:00:04",
                "IPv4Address": "172.17.0.4/16",
                "IPv6Address": ""
            },
            "c6caaa1f3878f770c3028da8883e0331d090901301ff59a6d85fd5fe4480cb6d": {
                "Name": "docker-server",
                "EndpointID": "9e6490b0ea1f1185d157e0492e9dbe855f40ee7e209f899926fcfce487a7d1e2",
                "MacAddress": "02:42:ac:11:00:02",
                "IPv4Address": "172.17.0.2/16",
                "IPv6Address": ""
            },
            "d94864c7fb9ed15c6528ef7b201de85c5cdaa0e9c9400c4fdd6b50d5a22b9b53": {
                "Name": "frosty_hermann",
                "EndpointID": "344296aaddbe6e21a6702c2b019dee74ab3b898a1e0e09da2aad2b824bf5afbe",
                "MacAddress": "02:42:ac:11:00:07",
                "IPv4Address": "172.17.0.7/16",
                "IPv6Address": ""
            }
        },
        "Options": {
            "com.docker.network.bridge.default_bridge": "true",
            "com.docker.network.bridge.enable_icc": "true",
            "com.docker.network.bridge.enable_ip_masquerade": "true",
            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",
            "com.docker.network.bridge.name": "docker0",
            "com.docker.network.driver.mtu": "65535"
        },
        "Labels": {}
    }
]

```
```
ansible-playbook -i ./k8s/hosts k8s-cicd-deployment-playbook.yml -u choihyewon;
ansible-playbook -i ./k8s/hosts k8s-cicd-service-playbook.yml -u choihyewon;
```
<br>

#### ë¹Œë“œ
```
choihyewon@choehyewon-ui-noteubug ~ % kubectl get all
NAME                                   READY   STATUS    RESTARTS   AGE
pod/cicd-deployment-5cb6bf89ff-whh2z   1/1     Running   0          15s
pod/cicd-deployment-5cb6bf89ff-zhrwd   1/1     Running   0          15s

NAME                   TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/cicd-service   NodePort    10.108.116.138   <none>        8080:32000/TCP   14s
service/kubernetes     ClusterIP   10.96.0.1        <none>        443/TCP          40h

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/cicd-deployment   2/2     2            2           16s

NAME                                         DESIRED   CURRENT   READY   AGE
replicaset.apps/cicd-deployment-5cb6bf89ff   2         2         2       16s
```
#### ê²°ê³¼
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/2bafee78-9ab7-41ec-a594-f18d461c1347" width="40%"/><br>

<br>

## 8. ì „ì²´ CI/CD ìë™í™” í”„ë¡œì„¸ìŠ¤ êµ¬ì„±
### Jenkins CI/CD Jobs
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/494d029d-386b-444c-8c0f-65258fd96a23" width="60%"/><br>
- CI ì‘ì—…ì„ í†µí•´ ìµœì‹  ì½”ë“œë¥¼ ê°€ì§€ê³  ë¹Œë“œëœ ê²°ê³¼ë¬¼ì´ ì´ë¯¸ì§€í™” ë˜ì–´ì„œ ë„ì»¤ hub Registryì— ë“±ë¡
- CD ì‘ì—…ì„ í†µí•´ Registry ì— ë“±ë¡ëœ ì´ë¯¸ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ ìí•˜ëŠ” ì„œë²„ì—ì„œ pull ë°›ì•„ì„œ í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìƒíƒœ(**service**)ë¡œ ë§Œë“ ë‹¤.
- replicaset 2 - 2ê°œì˜ pod

<br>

### CI
#### create-cicd-devops-image.yml
```
- hosts: all
#   become: true

  tasks:
  - name: create a docker image with deployed war file
    command: docker build -t won1110218/cicd-project-ansible .
    args: 
        chdir: /root
    
  - name: push the image on Docker Hub
    command: docker push won1110218/cicd-project-ansible

  - name: remove the docker image from the ansible server
    command: docker rmi won1110218/cicd-project-ansible  
    ignore_errors: yes
```
- playbook íŒŒì¼
- push : resistryì— ì—…ë¡œë“œ
- ì—…ë¡œë“œ ì„±ê³µí•˜ë©´ ë¡œì»¬ ì‹œìŠ¤í…œì— ìˆëŠ” ì´ë¯¸ì§€ ì‚­ì œ

<br>

#### Dockerfile
```yaml
FROM tomcat:latest

COPY ./hello-world.war /usr/local/tomcat/webapps
```
- latest ë²„ì „ì´ ì•„ë‹ˆë¼ 9.0 ë²„ì „ìœ¼ë¡œ
- ë¹Œë“œ í†µí•´ì„œ ë§Œë“¤ì–´ì§„ ê²°ê³¼ íŒŒì¼(hello-world.war)ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë³µì‚¬

### Ansible Playbookì„ ì´ìš©í•œ Docker Image ìƒì„±(CI job)
#### ğŸ“ìƒˆë¡œìš´ ì•„ì´í…œ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a6dcff4f-b176-4eb8-abde-db005a218dfb" width="60%"/><br>
- Item name -> My-K8s-Project-for-CI

<br>

#### ğŸ“ë¹Œë“œ ìœ ë°œ
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/8aad4a68-124d-4c89-9663-e212fced9cad" width="60%"/><br>
- Build Trigger
  - Poll SCM: *** * * * ***
  - ì½”ë“œê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆìœ¼ë©´ ì¸ì‹í•´ì„œ ì½”ë“œë¥¼ ìƒˆë¡œ ë‚´ë ¤ë°›ì•„ì„œ ìë™ìœ¼ë¡œ CIì‘ì—…ì´ ë  ìˆ˜ ìˆë„ë¡ êµ¬ì¶•

<br>

#### ğŸ“ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d23fc983-4497-42d1-8ee1-703070cb828c" width="60%"/><br>
- Post-build Actions
  - SSH Server: **ansible-sever**
- Exec command
  ```
  ansible-playbook -i ./k8s/hosts create-cicd-devops-image.yml --limit ansible-server
  ```
  - host - inventory íŒŒì¼ ëŒ€ìƒ [ansible-server] 

#### ê²°ê³¼
**ë¹Œë“œ â†’ dockerhubì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ í™•ì¸**
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/3cd1ea21-e656-4d92-8867-3721e5e65287" width="60%"/><br>

<br>

### CD
CI ì‘ì—…ì„ í†µí•´ Registry ì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ì‘ì—…
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/04cafe00-e345-40a9-8766-2d6107a07255" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d5e6dbfe-0243-4cd3-8791-4d19c6986ca7" width="60%"/><br>
- **Post-build Actions(ë¹Œë“œ í›„ ì¡°ì¹˜)**
  - **Build other projects** : í˜„ì¬ ì‘ì—…ì´ ëë‚˜ê³  ë¹Œë“œ í›„ì— ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¥¼ ë˜ ë‹¤ì‹œ ì‹¤í–‰í•˜ê² ë‹¤ëŠ” ì˜ë¯¸
    - í˜„ì¬ ìˆëŠ” í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì„±ê³µí•œ ë‹¤ìŒì— ì•ì„œ ë§Œë“¤ì—ˆë˜ ì´ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•´ë‹¬ë¼
      - CIì™€ CDê°€ ì—°ì‡„ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ê² ë‹¤ëŠ” ëœ»!
      - CI ì‘ì—…ì—ì„œ ì´ë¯¸ì§€ê°€ í—ˆë¸Œ ì‚¬ì´íŠ¸ì— ì—…ë¡œë“œê°€ ë˜ë©´ ì‘ì—…ì´ ì™„ë£Œê°€ ë˜ê³ , CD ì‘ì—…ì—ì„œëŠ” ìš°ë¦¬ê°€ ì›í–ˆë˜ hub ì‚¬ì´íŠ¸ë¡œë¶€í„° ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œë¶€í„° ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ì™€ì„œ k8sì— ì ìš©í•˜ê¸° ìœ„í•œ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ì‹¤í–‰(pod ë‘ ê°œ ì‹¤í–‰, ì„œë¹„ìŠ¤ ìƒì„±)
    - Deploy on Kubernetes CD (CD job) : **My-K8s-Project-Ansible(ë””í”Œë¡œì´ë¨¼íŠ¸, ì„œë¹„ìŠ¤)**
    - Trigger only if builds is stable

<br>

### ê²°ê³¼
ë¹Œë“œ â†’ ì„±ê³µ
#### CI
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d48f6cd7-5fb0-4768-92bf-cced3683c21f" width="30%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/16b226aa-18c8-4bc6-864f-c616abea7d47" width="60%"/><br>

<br>

#### ìµœì¢…ì ìœ¼ë¡œ k8s ì„œë²„ì— ë°˜ì˜ì´ ëëŠ”ê°€ í™•ì¸
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a204b106-0e3b-4f8e-a058-9d85d08c1c8e" width="60%"/><br>


> ğŸ§‘ğŸ»â€ğŸ« 
> CI ì‘ì—…(Maven project My-K8s-Project-for-CI)ì—ë„ gihubì— ë³€ê²½ëœ ì½”ë“œê°€ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ê°±ì‹ <br>
> CD ì‘ì—…(Maven project My-K8s-Project-using-Ansible) Poll SCM í•´ì œí•´ì£¼ê¸°

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/2e637cd5-b174-415d-a27a-1c359de596b1" width="60%"/><br>
- githubì— ë³€ê²½ë˜ì–´ ìˆëŠ” ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ë¹Œë“œí•˜ëŠ” ì‘ì—…ì€ CIì‘ì—…ì—ì„œë§Œ!

<br>

ì½”ë“œ ìˆ˜ì • í›„ ì»¤ë°‹/í‘¸ì‹œ<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b0e67435-63d3-49aa-bc49-d0e6787ff8aa" width="30%"/><br>
CI ìë™ìœ¼ë¡œ ë¹Œë“œ ì§„í–‰ë¨<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/79619ecb-5dc4-4fb2-801f-f53d374d2647" width="30%"/><br>
CDì‘ì—…ì—ì„œ CIê°€ ëë‚˜ì ë§ˆì ë¹Œë“œ ì‹¤í–‰ë¨<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d27de145-8fb0-41a1-b3c0-378fbcbd47e9" width="60%"/><br>

```
choihyewon@choehyewon-ui-noteubug ~ % kubectl get all
NAME                                   READY   STATUS    RESTARTS   AGE
pod/cicd-deployment-5cb6bf89ff-dz96d   1/1     Running   0          72s
pod/cicd-deployment-5cb6bf89ff-mtc7w   1/1     Running   0          72s

NAME                   TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/cicd-service   NodePort    10.105.129.83   <none>        8080:32000/TCP   70s
service/kubernetes     ClusterIP   10.96.0.1       <none>        443/TCP          2d13h

NAME                              READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/cicd-deployment   2/2     2            2           72s

NAME                                         DESIRED   CURRENT   READY   AGE
replicaset.apps/cicd-deployment-5cb6bf89ff   2         2         2       72s
```

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/40e55f8c-2c4d-4660-8523-33e6eee6d373" width="40%"/><br>
- ë³€ê²½ì½”ë“œ(2.0)ë¡œ ìˆ˜ì •ë˜ì—ˆë‹¤.