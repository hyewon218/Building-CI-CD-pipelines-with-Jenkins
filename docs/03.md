# Jenkins + Infrastructure as Code ì™€ì˜ ì—°ë™


## 1. Infrastructure as Code ê°œìš”ì™€ Ansibleì˜ ì´í•´
### IaC
- í”„ë¡œë¹„ì €ë‹ ë„êµ¬
- ì´ë¦„ ê·¸ëŒ€ë¡œ **ì½”ë“œì— ì˜í•´ì„œ** Infrastructure ë¥¼ ê´€ë¦¬í•œë‹¤. -> ìƒì„±, ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ì‚­ì œ, ...
- ì‹œìŠ¤í…œ, í•˜ë“œì›¨ì–´ ë˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬ì„±ì •ë³´ë¥¼ íŒŒì¼(**ìŠ¤í¬ë¦½íŠ¸**)ì„ í†µí•´ ê´€ë¦¬ ë° í”„ë¡œë¹„ì €ë‹
- IT ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜, ë² ì–´ ë©”íƒˆ ì„œë²„(í•˜ë“œì›¨ì–´ì— ì–´ë– í•œ ì†Œí”„íŠ¸ì›¨ì–´ë„ ì„¤ì¹˜ë˜ì–´ìˆì§€ ì•Šì€ ìˆœìˆ˜í•œ í•˜ë“œì›¨ì–´) ë“±ì˜<br> ë¬¼ë¦¬ ì¥ë¹„ ë° ê°€ìƒ ë¨¸ì‹ ê³¼ ê´€ë ¨ëœ êµ¬ì„± ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬ -> ìš´ì˜ì²´ì œ, ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ë¯¸ë“¤ì›¨ì–´ì„¤ì¹˜ ê´€ë¦¬
- ë²„ì „ ê´€ë¦¬ë¥¼ í†µí•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
- `Ansible`, `Terraform`, `CHEF`, AWS Cloud Formation, puppet, ...
- Ansible ì€ ê¸°ì¡´ì— ì´ë¯¸ êµ¬ì„±ë˜ì–´ ìˆëŠ” ì„œë²„ë“¤ì˜ **ì •ë³´ ë³€ê²½**ì´ë‚˜ **ì„¤ì •**ë“¤ì„< ì›í•˜ëŠ” í˜•íƒœë¡œ ë°”ê¾¸ëŠ”ë° íŠ¹í™”ë˜ì–´ ìˆëŠ” IaC ë„êµ¬
- Ansibleì€ ë‹¤ë¥¸ IaC ëŒ€ë¹„í•´ì„œ ê°€ë³ê³  ë¹ ë¥´ê²Œ ì›í•˜ëŠ” ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì„ ê°€ì§„ë‹¤.
- Ansibleì€ êµ¬ì„±ê´€ë¦¬ ë„êµ¬ë¼ê³  ë¶ˆë¦¬ê¸° ë•Œë¬¸ì— ì‹œìŠ¤í…œì„ êµì²´í•˜ëŠ” ì‘ì—…ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ê·¸ëŸ¬í•œ ì‘ì—…ë³´ë‹¤ëŠ”<br> **ë¬¸ì œì ì„ í•´ê²°í•˜ëŠ” ìš©ë„**(ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë³µêµ¬í•˜ëŠ” ë°©ë²•ì„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ê¸°ë¡)ë¡œ ì‚¬ìš©í•œë‹¤.
- Ansibleì€ AWSì™€ ì—°ë™ì´ ì˜ ë˜ì–´ S3, EC2, Lamda ë“± 100ê°œ ì´ìƒì˜ ëª¨ë“ˆê³¼ ì—°ê²°ì„ í•´ì„œ<br> ì›í•˜ëŠ” êµ¬ì„± ì •ë³´ë¼ë“ ê°€ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ì´ ëœë‹¤.
- Terraform ì€ Infrastructure ë¥¼ êµ¬ì¶•í•˜ëŠ”ë° ì£¼ë¡œ ì‚¬ìš©ë˜ê³ , Ansible ì€ êµ¬ì¶•ëœ ì„œë²„ë“¤ì˜ êµ¬ì„±ì •ë³´ë¥¼ **ë³€ê²½**í•˜ê±°ë‚˜ **ê´€ë¦¬**í•˜ëŠ”ë° ì£¼ë¡œ ì‚¬ìš©ëœë‹¤.

<br>

### Before & After Configure management
#### Before
êµ¬ì„±ì •ë³´ íŒŒì¼ì„ ë‹¤ë£¨ëŠ”ë° ìˆì–´ì„œ IaCë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ ë•Œ<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a1691fc4-79d5-4080-b8e0-ea9b02ac589f" width="60%"/><br>
- ì„œë²„ê°€ 4ëŒ€ê°€ ì¡´ì¬í•˜ê³ , ë‹¤ì–‘í•œ í˜•íƒœì˜ ë””ë°”ì´ìŠ¤ë¥¼ í†µí•´ ì„œë²„ë¥¼ ê´€ë¦¬
- íŠ¹ì • ì„œë²„ì— ì˜¤ë¥˜ê°€ ìƒê²¨ì„œ ê´€ë¦¬ìê°€ ì•Œê²Œë˜ë©´ ì˜¤ë¥˜ ìƒê¸´ ì„œë²„ë¥¼ ì§€ìš°ê³  í•„ìš”í•œ ì„œë²„ë¥¼ ì¦ì„¤í•˜ì—¬ ì •ìƒì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›

<br>

#### After
ìœ„ ì‘ì—…ì„ í•˜ëŠ”ë° ìˆì–´ì„œ IaCë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/f7b8558f-e0f8-46e7-8fe2-f5da5a1525d1" width="60%"/><br>
- Ansibleì— ì„œë²„ë“¤ì„ ê´€ë¦¬í•˜ë„ë¡ ì§€ì • -> inventory
- ì„œë²„ë¥¼ ê´€ë¦¬í•¨ì— ìˆì–´ì„œ ì„œë²„ì˜ ëª©ë¡ì´ë‚˜ ì‘ì—… ì ˆì°¨ë¥¼ ë‹´ì•„ë‘” ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì§€ì • -> Play Books

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a3edea21-89de-45fc-9241-9a9b32bbd411" width="60%"/><br>
- ì„œë²„ í•œëŒ€ê°€ ë¬¸ì œê°€ ìƒê¸´ë‹¤ë©´ Play Booksì— ê¸°ë¡ëœ ì •ë³´ì— ì˜í•´ì„œ ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ ì„œë²„ë¥¼ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ í†µí•´ ì •ìƒì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›
- ì´ì™€ ê°™ì´ ê´€ë¦¬ìê°€ ì§ì ‘í•´ì•¼í•˜ëŠ” ì¸í”„ë¼ì˜ ì œì–´ë‚˜ ê´€ë¦¬ë¥¼ Ansible, Terraform ê³¼ ê°™ì€ IaC ë„êµ¬ë¥¼ í†µí•´ ëŒ€ì‹  ê´€ë¦¬ ê°€ëŠ¥
- ì´ì™€ ê°™ì´ ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ì„œë²„ëŠ” Ansibleì„ í†µí•´ì„œ ì§€ì†ì ìœ¼ë¡œ ìƒíƒœë¥¼ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•´ì¤€ë‹¤.

<br>

### Configuration Management Tools
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/8fa65733-7980-4dee-844f-479f52bb3b17" width="60%"/><br>
- Ansibleì˜ ê°€ì¥ í° í•µì‹¬ì€ Agentê°€ ë¶ˆí•„ìš”í•˜ë‹¤ëŠ” ë¶€ë¶„
- ëŒ€ë¶€ë¶„ ë©”ì¸ ì„œë²„(Ansible ì„œë²„)ê°€ ìš´ì˜ ì„œë²„(í´ë¼ì´ì–¸íŠ¸)ë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ìˆì–´ì„œ ìš´ì˜ ì„œë²„(í´ë¼ì´ì–¸íŠ¸)ë“¤ì€ ë©”ì¸ ì„œë²„(Ansible ì„œë²„)ë¡œ ë¶€í„° ì •ë³´ë¥¼ ì „ë‹¬ ë°›ê¸° ìœ„í•œ Agent(í´ë¼ì´ì–¸íŠ¸) ë“¤ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ëŒ€ë¶€ë¶„ì´ê³  ì´ëŸ¬í•œ Agent(í´ë¼ì´ì–¸íŠ¸)ì™€ ë©”ì¸ ì„œë²„(Ansible ì„œë²„) ì‚¬ì´ì˜ í”„ë¡œí† ì½œ í†µí•´ í†µì‹ ì„ í•´ì„œ ì‘ì—…ì„ ì£¼ê³  ë°›ëŠ”ë‹¤.
- Ansible ì„ ì‚¬ìš©í•˜ë©´ ìš´ì˜ ì„œë²„(í´ë¼ì´ì–¸íŠ¸) ì´ëŸ¬í•œ Agent ê°€ í•„ìš”ì—†ë‹¤.
- ì´ìœ ëŠ” ê°ê°ì˜ ì„œë²„ì— Python ì–¸ì–´ê°€ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ Pythonì´ ê°€ì§„ ë„¤íŠ¸ì›Œí¬ ëª¨ë“ˆì„ í†µí•´ì„œ ì„œë²„ì™€ í†µì‹ í•˜ê¸° ë•Œë¬¸ì´ë‹¤. -> ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œì€ ê¸°ë³¸ì ìœ¼ë¡œ Pythonì´ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤.

<br>

### Ansible
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d95c9629-6f0e-4c41-9299-ce026245d91a" width="60%"/><br>
- ì—¬ëŸ¬ ê°œì˜ ì„œë²„ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” í™˜ê²½ êµ¬ì„± **ìë™í™”** ë„êµ¬
    - Configuration Management, Deployment & Orchestration tool
    - IT infrastructure **ìë™í™”**
- **Push** ê¸°ë°˜ ì„œë¹„ìŠ¤
- Simple, **Agentless**(ë³„ë„ë¡œ ê´€ë¦¬í•˜ê³ ìí•˜ëŠ” ëŒ€ìƒ ì„œë²„ì— ì¶”ê°€ë¡œ ì„¤ì¹˜í•  ë‚´ìš©ì´ í¬í•¨ë˜ì–´ìˆì§€ ì•Šë‹¤.)
- í•  ìˆ˜ ìˆëŠ”ì¼<br>
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b9bdbd8b-1933-4190-989b-dafa4538098d" width="60%"/><br>
    - ì„¤ì¹˜: apt-get, yum, homebrew
    - íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ ë°°í¬: copy
    - ë‹¤ìš´ë¡œë“œ: get_url, git
    - ì‹¤í–‰: shell, task
    - ì¦‰, Ansible ì„œë²„ì—ì„œ ëŒ€ìƒ ì„œë²„ê°€ ë˜ëŠ” ê³³ì— í”„ë¡œê·¸ë¨ì„  ì„¤ì¹˜, íŒŒì¼ ë° ìŠ¤í¬ë¦½íŠ¸ ë°°í¬, ë‹¤ìš´ë¡œë“œ, ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ë‹¤.
- ê²°ê³¼
    - `ok` / `failed` / `changed` / `unreachable`
- êµ¬ì„±ë„ ì˜ˆì‹œ<br>
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/f4098c90-854c-474e-b948-17b88d0f1e70" width="60%"/><br>

### Install Ansible
- Ansible Server ì„¤ì¹˜ (Linux)
  - `yum install ansible`
  - `ansible --version`
- í™˜ê²½ ì„¤ì • íŒŒì¼ ->Â `/etc/ansible/ansible.cfg`
- Ansible ì—ì„œ ì ‘ì†í•˜ëŠ” í˜¸ìŠ¤íŠ¸ ëª©ë¡ ->Â `/etc/ansible/hosts`
  - nginx ë¼ëŠ” ê·¸ë£¹ì˜ ëª©ë¡ë“¤<br>
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/18d42c40-48b5-4133-89b4-7b11094756a0" width="30%"/><br>

<br>

## 2. Docker ì»¨í…Œì´ë„ˆë¡œ Ansible ì‹¤í–‰í•˜ê¸°
### Create a docker instance for Ansible
- Ansibleì„ ê°€ì§€ê³  ìˆëŠ” ë„ì»¤ ì´ë¯¸ì§€ -> edowon0623/ansible
  ```
  docker pull edowon0623/ansible-server:m1
  ```
  ```
  choihyewon@choehyewon-ui-noteubug ~ % docker pull edowon0623/ansible-server:m1
  m1: Pulling from edowon0623/ansible-server
  52f9ef134af7: Already exists
  b0057b9a5ec7: Already exists
  5de1b09ce5f0: Already exists
  220446312972: Already exists
  3315db72bb66: Already exists
  d7b146b2846c: Already exists
  6ad839f282f8: Already exists
  9a32b78ae1f2: Already exists
  d27b78b9e37a: Already exists
  057d0583946b: Already exists
  92b30088b9f6: Already exists
  de85a0cecf04: Already exists
  2722065ffa48: Already exists
  be62d423d9d9: Pull complete
  b961e375c3bf: Pull complete
  318fa5a009d7: Pull complete
  a3ed95caeb02: Pull complete
  cf7db50c8c20: Pull complete
  Digest: sha256:84fbc1d619401f50dd5327f20d996b6cba5a9bfe00da7079b79572828fd5173f
  Status: Downloaded newer image for edowon0623/ansible-server:m1
  docker.io/edowon0623/ansible-server:m1

  What's Next?
  View summary of image vulnerabilities and recommendations â†’ docker scout quickview edowon0623/ansible-server:m1
  ```
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/58a5c7e3-25d5-4301-bfe6-33e373b85bdd" width="60%"/><br>

<br>

### Run Ansible Server
#### ğŸ“ì‹¤í–‰
```
docker run --privileged --name ansible-server -itd -p 20022:22 -p 8082:8080 -e container=docker -v /sys/fs/cgroup:/sys/fs/cgroup --cgroupns=host edowon0623/ansible-server:m1 /usr/sbin/init
```
- --privileged: ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§€ê³  ì‹¤í–‰
<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/935e258c-c803-4333-a632-09a39fdf31a8" width="60%"/><br>

<br>

#### ğŸ“Docker network ìƒì„¸ë³´ê¸°
```
docker network inspect bridge
```
```
 ~ % docker network inspect bridge
[
    {
        "Name": "bridge",
        "Id": "ca762f1e65e3ae81dc07dbfe96282f93a17a420487ef05a598f7688df4b5c9fd",
        "Created": "2023-11-09T00:45:38.966240333Z",
        "Scope": "local",
        "Driver": "bridge",
        "EnableIPv6": false,
        "IPAM": {
            "Driver": "default",
            "Options": null,
            "Config": [
                {
                    "Subnet": "172.17.0.0/16",
                    "Gateway": "172.17.0.1"
                }
            ]
        },
        "Internal": false,
        "Attachable": false,
        "Ingress": false,
        "ConfigFrom": {
            "Network": ""
        },
        "ConfigOnly": false,
        "Containers": {
            "67df6243d6351c58a100eda103e4efe8fa2a868fbc5c7a556281ff6cb9c75811": {
                "Name": "jenkins-server",
                "EndpointID": "d21d6e693f64da022c3e512b43c5add10cc60e088e9d2a6b28c32a0ded62baa5",
                "MacAddress": "02:42:ac:11:00:03",
                "IPv4Address": "172.17.0.3/16",
                "IPv6Address": ""
            },
            "b2b74aa4e31b70897cb042cb12a4e7efac91c495703509034494587d11f7f093": {
                "Name": "ansible-server",
                "EndpointID": "94963be69cefdd9078a1eeebe4b7038334d57419f00f5e0fec0ea7b820b4cf8a",
                "MacAddress": "02:42:ac:11:00:04",
                "IPv4Address": "172.17.0.4/16",
                "IPv6Address": ""
            },
            "c6caaa1f3878f770c3028da8883e0331d090901301ff59a6d85fd5fe4480cb6d": {
                "Name": "docker-server",
                "EndpointID": "f94eddc2a15d4097fd89e90c7386d75ea1672593a0e9dbaa0323c3cf937ff4f1",
                "MacAddress": "02:42:ac:11:00:02",
                "IPv4Address": "172.17.0.2/16",
                "IPv6Address": ""
            }
        },
        "Options": {
            "com.docker.network.bridge.default_bridge": "true",
            "com.docker.network.bridge.enable_icc": "true",
            "com.docker.network.bridge.enable_ip_masquerade": "true",
            "com.docker.network.bridge.host_binding_ipv4": "0.0.0.0",
            "com.docker.network.bridge.name": "docker0",
            "com.docker.network.driver.mtu": "65535"
        },
        "Labels": {}
    }
]
```
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e8b17d3d-62af-4625-b3e1-5b34f8b4ebf0" width="60%"/><br>

- ì»¨í…Œì´ë„ˆì—ì„œ ì‹¤í–‰)
  - `$ systemctl start docker`
  - `$ systemctl status docker`

<br>

#### ğŸ“SSH ì ‘ì†
```
ssh root@localhost -p 20022
```
<br>

#### ğŸ“ansible ë²„ì „ í™•ì¸
```
ansible --version
```
```
[root@b2b74aa4e31b ~]# ansible --version
ansible [core 2.13.2]
  config file = None
  configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/local/lib/python3.8/site-packages/ansible
  ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/local/bin/ansible
  python version = 3.8.8 (default, Aug 25 2021, 16:18:04) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)]
  jinja version = 3.1.2
  libyaml = True
```

<br>

#### ğŸ“inventory
```
vi /etc/ansible/hosts
```
- ansibledì˜ í´ë¼ì´ì–¸íŠ¸ë“¤ì— ëŒ€í•œ ì •ë³´ ë“±ë¡

```
[devops](ê·¸ë£¹ëª…)
172.17.0.2 (docker)
172.17.0.4 (ansible)
```
- ì„ì‹œë¡œ ë“±ë¡í•´ ë†“ì€ ì •ë³´ì´ê¸° ë•Œë¬¸ì— í™˜ê²½ì— ë§ì¶° ìˆ˜ì •í•´ì•¼ í•¨
- ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ì— ë“±ë¡ë˜ì–´ì§„ ì»¨í…Œì´ë„ˆì˜ ëª©ë¡ì„ ë³¼ ìˆ˜ ìˆë‹¤.<br>
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/2bff9085-0864-4a8b-a008-fabb19f187ab" width="60%"/><br>

<br>

#### ğŸ“ í‚¤ ìƒì„±) ssh-keygen
> Ansible ì„œë²„ì—ì„œ ë“±ë¡í•œ ëŒ€ìƒ ì„œë²„ë“¤ë¡œ SSHë¥¼ í†µí•´ ì ‘ì†í•˜ëŠ” ë° ìˆì–´ì„œ id â€¢ passwordë¥¼ í†µí•´ ì ‘ì†í•˜ëŠ”ë°, <br>
> Ansibleì„ í†µí•´ì„œ ì‹¤í–‰í•˜ë ¤ëŠ” ì»¤ë§¨ë“œì— ì ‘ì†í•  ë•Œ ë§¤ë²ˆ idì™€ passwordë¥¼ ì…ë ¥í•˜ê¸° ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— <br>
> Ansible ì„œë²„ì— ì¡´ì¬í•˜ëŠ” í‚¤ê°’ì„ ê°€ì§€ê³  ëŒ€ìƒ ì„œë²„ì— ë°°í¬í•¨ìœ¼ë¡œì¨ id â€¢ password ì—†ì´ ì ‘ì†í•˜ê²Œ í•œë‹¤.<br>

```
ssh-keygen
```
- /root/.ssh/id_rsa (id_rsa: í¼ë¸”ë¦­, í”„ë¼ì´ë¹— í‚¤) ìƒì„±

```
[root@b2b74aa4e31b ~]# ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:

The key's randomart image is:

```
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/3e411801-caf0-4abf-8887-d4e73c91750a" width="60%"/><br>


<br>

#### ğŸ“í‚¤ ë³µì‚¬) ssh-copy-id root@[ì ‘ì†í•  ì„œë²„ IP]
```
ssh-copy-id root@172.17.0.3
```
- í‚¤ ê°’ì„ (ê°ê° ì„œë²„ì—)**ë°°í¬**í•˜ì—¬ ì ‘ì†ì‹œ ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ ìƒëµ ê°€ëŠ¥
- ì´ ë°°í¬ ì‘ì—…ì„ í•´ì•¼ ì´í›„ì— ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‘ì—…ì„ í•¨ì— ìˆì–´ ë³„ë„ë¡œ íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥í•˜ì§€ ì•Šì€ ìƒíƒœë¡œ ì‘ì—…í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

<br>

## 3. Ansible ì„¤ì •ê³¼ ì‘ë™ ê³¼ì •

- docker-server: 172.17.0.2
- ansible-server: 172.17.0.4

### inventory ìƒì„±
```
mkdir /etc/ansible
vi /etc/ansible/hosts
```

<br>

### /etc/ansible/hosts
```
[devops]
172.17.0.2
172.17.0.4
```
- docker-server í´ë¼ì´ì–¸íŠ¸ë¡œ ê´€ë¦¬
- ansible-server ìê¸° ìì‹ ë„ í´ë¼ì´ì–¸íŠ¸ë¡œ ê´€ë¦¬(localhost)

### í˜„ì¬ìƒí™© (java ì œì™¸)
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/ef079de5-9d79-4d91-9507-59f84d3e7a93" width="60%"/><br>
<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/64508387-a33b-42f4-9289-a4ae93c9f5fc" width="60%"/><br>
- Ansible ì„œë²„ ì•ˆì—ì„œ ë‹¤ë¥¸ ì„œë²„ë¡œ ì ‘ì†í•  ë•ŒëŠ” í¬íŠ¸í¬ì›Œë”© X<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/efbd0011-dd16-4eea-b2b2-718f8eee609e" width="60%"/><br>

<br>

```
[root@b2b74aa4e31b ~]# ssh root@172.17.0.2 - b2b74aa4e31b (host ì»¨í…Œì´ë„ˆ id)
The authenticity of host '172.17.0.2 (172.17.0.2)' can't be established.
ECDSA key fingerprint is SHA256:rbybV2UK8eDvAGhSTNuhNkez9rYPTrPCCR4NpSVV+xc.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.17.0.2' (ECDSA) to the list of known hosts.
root@172.17.0.2's password: 
Last login: Wed Nov  8 06:34:11 2023 from 172.17.0.1
[root@c6caaa1f3878 ~]# - c6caaa1f3878 (docker ì»¨í…Œì´ë„ˆ id)

[root@c6caaa1f3878 ~]# exit
logout
Connection to 172.17.0.2 closed.
[root@b2b74aa4e31b ~]# ssh-copy-id root@172.17.0.2
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.17.0.2's password: (ì²˜ìŒ í•œ ë²ˆ ì…ë ¥í•´ì£¼ë©´!)

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.17.0.2'"
and check to make sure that only the key(s) you wanted were added.

[root@b2b74aa4e31b ~]# ssh root@172.17.0.2 (ë‹¤ì‹œ ì ‘ì†í•˜ë©´ ë¡œê·¸ì¸ ì—†ì´ ì ‘ì†ë¨)
Last login: Thu Nov  9 07:59:53 2023 from 172.17.0.4
```
```
[root@c6caaa1f3878 ~]# exit
logout
Connection to 172.17.0.2 closed.
[root@b2b74aa4e31b ~]# ssh root@172.17.0.4 (ìê¸° ìì‹  ì ‘ì†)
The authenticity of host '172.17.0.4 (172.17.0.4)' can't be established.
ECDSA key fingerprint is SHA256:L+KnXcoaiu8SkOYLNCVPMAj3+1v8aIbaZMmB+Du67GE.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.17.0.4' (ECDSA) to the list of known hosts.
root@172.17.0.4's password: 
Last login: Thu Nov  9 05:52:41 2023 from 172.17.0.1
[root@b2b74aa4e31b ~]# exit
logout
Connection to 172.17.0.4 closed.
[root@b2b74aa4e31b ~]# ssh root@172.17.0.4
root@172.17.0.4's password: 
Last login: Thu Nov  9 09:08:38 2023 from 172.17.0.4
[root@b2b74aa4e31b ~]# exit
logout
Connection to 172.17.0.4 closed.
[root@b2b74aa4e31b ~]# ssh-copy-id root@172.17.0.4
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.17.0.4's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.17.0.4'"
and check to make sure that only the key(s) you wanted were added.

[root@b2b74aa4e31b ~]# ssh root@172.17.0.4
Last login: Thu Nov  9 09:09:26 2023 from 172.17.0.4
```


