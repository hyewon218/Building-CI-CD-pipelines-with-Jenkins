# Jenkinsë¥¼ ì´ìš©í•œ CI/CD ìë™í™” ë„êµ¬ì˜ ì‚¬ìš©
## 1. CI/CDë¥¼ ìœ„í•œ Git, Maven ì„¤ì •
### Git
#### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/cc5a6408-6520-4974-90c7-8d7f5e3976db" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/2db5d0a6-2eef-4e98-a671-a8cb127222eb" width="60%"/>

<br>

### Maven
#### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/516680b3-6fe9-4a78-9736-169fdd5e9f66" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/fed4933c-9867-4a55-a608-70cacbaac0b2" width="60%"/>

<br>
<br>

**ğŸ“ ë©”ì´ë¸ì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ ë²„ì „ í™•ì¸**<br>
```
jenkins@67df6243d635:/$ mvn --version
bash: mvn: command not found
```
>bash: mvn: command not found â†’ ì„¤ì¹˜ê°€ ì•ˆ ë˜ì–´ìˆë‹¤ëŠ” ë§!

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/7affc1f4-0ce5-4875-bd8b-6c4e7620356e" width="60%"/>

## 2. Maven í”„ë¡œì íŠ¸ ìƒì„±
### ë‘ë²ˆì§¸ ì•„ì´í…œ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/b36de5fe-aa36-4fe3-ae07-97f3fbba6e4b" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/7ddbeafa-e849-41c7-97e8-f7d5cc2a7519" width="60%"/>

<br>
<br>

#### ğŸ“ì†ŒìŠ¤ì½”ë“œ ê´€ë¦¬ 

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/d61a176b-4cff-4e11-8627-ace645febe57" width="60%"/>

- ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¬ ë ˆí¬ì§€í† ë¦¬ ëª…ì‹œ
- master â†’ main ë¸Œëœì¹˜ë¡œ ë³€ê²½

<br>

#### ğŸ“Build

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/06098f0b-e290-46c1-b3e7-02f88fa2b07f" width="60%"/>

- maven í”„ë¡œì íŠ¸ì´ë¯€ë¡œ maven ë¹Œë“œ íˆ´ë¡œ ì»´íŒŒì¼
- **Root POM: pom.xml**
    - maven ê´€ë ¨ ì„¤ì •íŒŒì¼ ê¸°ë°˜ìœ¼ë¡œ ë¹Œë“œ
- **Golds: clean compile package**
    - clean : ì´ì „ ë¹Œë“œ ì‚­ì œ
    - compile : ì»´íŒŒì¼
    - package : ì»´íŒŒì¼ëœ ë‚´ìš©ì„ ê°€ì§€ê³  pom.xml íŒŒì¼ì— ì§€ì •ëœ ì˜µì…˜ì„ ë”°ë¼ì„œ package íŒŒì¼ ìƒì„±
    - pom.xml íŒŒì¼
        ```xml
      <project xmlns="http://maven.apache.org/POM/4.0.0"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
		       http://maven.apache.org/maven-v4_0_0.xsd">
        <modelVersion>4.0.0</modelVersion>
        <groupId>com.njonecompany.web</groupId>
        <artifactId>web</artifactId>
        <packaging>war</packaging>
<br>
<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/161a1cc1-e953-4521-91e9-6ea88ec78643" width="60%"/>

#### ğŸ“ ì§€ê¸ˆ ë¹Œë“œ
```
[INFO] Building war: /var/jenkins_home/workspace/My-Second-Project/target/hello-world.war
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  8.301 s
[INFO] Finished at: 2023-11-03T17:28:36Z
[INFO] ------------------------------------------------------------------------
Waiting for Jenkins to finish collecting data
[JENKINS] Archiving /var/jenkins_home/workspace/My-Second-Project/pom.xml to com.njonecompany.web/web/1.0/web-1.0.pom
[JENKINS] Archiving /var/jenkins_home/workspace/My-Second-Project/target/hello-world.war to com.njonecompany.web/web/1.0/web-1.0.war
channel stopped
Finished: SUCCESS
```
<br>


#### â­ï¸ Jenkins on Docker
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a3fb662e-85cb-47aa-842e-755d4df7eb3e" width="60%"/>

```
 ~ % docker exec -it jenkins-server bash
jenkins@67df6243d635:/$ cd /var/jenkins_home/
jenkins@67df6243d635:~$ ls
config.xml
copy_reference_file.log
fingerprints
hudson.model.UpdateCenter.xml
hudson.plugins.git.GitTool.xml
hudson.plugins.gradle.Gradle.xml
hudson.tasks.Ant.xml
hudson.tasks.Maven.xml
identity.key.enc
jenkins.install.InstallUtil.lastExecVersion
jenkins.install.UpgradeWizard.state
jenkins.model.JenkinsLocationConfiguration.xml
jenkins.mvn.GlobalMavenConfig.xml
jenkins.telemetry.Correlator.xml
jobs
logs
nodeMonitors.xml
nodes
org.jenkinsci.plugins.gitclient.JGitApacheTool.xml
org.jenkinsci.plugins.gitclient.JGitTool.xml
plugins
queue.xml
secret.key
secret.key.not-so-secret
secrets
tools
updates
userContent
users
war
workspace
jenkins@67df6243d635:~$ cd workspace
jenkins@67df6243d635:~/workspace$ ls
Building-CI-CD-pipelines-with-Jenkins  My-Second-Project
jenkins@67df6243d635:~/workspace$ cd My-Second-Project/
jenkins@67df6243d635:~/workspace/My-Second-Project$ ls -al
total 24
drwxr-xr-x  5 jenkins jenkins 4096 Nov  3 17:28 .
drwxr-xr-x  4 jenkins jenkins 4096 Nov  3 17:24 ..
drwxr-xr-x  8 jenkins jenkins 4096 Nov  3 17:28 .git
-rw-r--r--  1 jenkins jenkins 3631 Nov  3 17:28 pom.xml
drwxr-xr-x  4 jenkins jenkins 4096 Nov  3 17:28 src
drwxr-xr-x 10 jenkins jenkins 4096 Nov  3 17:28 target
jenkins@67df6243d635:~/workspace/My-Second-Project$ cd target
jenkins@67df6243d635:~/workspace/My-Second-Project/target$ ls -al
total 7880
drwxr-xr-x 10 jenkins jenkins    4096 Nov  3 17:28 .
drwxr-xr-x  5 jenkins jenkins    4096 Nov  3 17:28 ..
drwxr-xr-x  3 jenkins jenkins    4096 Nov  3 17:28 classes
drwxr-xr-x  3 jenkins jenkins    4096 Nov  3 17:28 generated-sources
drwxr-xr-x  3 jenkins jenkins    4096 Nov  3 17:28 generated-test-sources
drwxr-xr-x  4 jenkins jenkins    4096 Nov  3 17:28 hello-world
-rw-r--r--  1 jenkins jenkins 8025948 Nov  3 17:28 hello-world.war
drwxr-xr-x  2 jenkins jenkins    4096 Nov  3 17:28 maven-archiver
drwxr-xr-x  3 jenkins jenkins    4096 Nov  3 17:28 maven-status
drwxr-xr-x  2 jenkins jenkins    4096 Nov  3 17:28 surefire-reports
drwxr-xr-x  3 jenkins jenkins    4096 Nov  3 17:28 test-classes
```

ğŸ”¥ ìµœì¢…ì ìœ¼ë¡œ build ì„±ê³µ í›„ workspaceì— build ê²°ê³¼ë¬¼(webapp/target/xxx) ìƒì„± -> **hello-world.war**

<br>

## 3. CI/CD ì‘ì—…ì„ ìœ„í•œ Tomcat ì„œë²„ ì—°ë™
### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/53021d70-b283-4d1a-927b-c81f077f8ed2" width="60%"/>

> ğŸ§‘ğŸ»â€ğŸ« ì´ í”ŒëŸ¬ê·¸ì¸ì´ ìˆì–´ì•¼ Jenkinsì—ì„œ ì•ì„  ì‹œê°„ì— íŒ¨í‚¤ì§•í–ˆë˜ WAR íŒŒì¼ì„ Tomcat ì„œë²„ì—ë‹¤ê°€ ë³µì‚¬ë¥¼ í•´ ë„£ì„ ìˆ˜ ìˆë‹¤.

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/6e293035-e5b8-499b-95f0-430cdfecdccf" width="60%"/>

### ì„¸ë²ˆì§¸ ì•„ì´í…œ ìƒì„±
#### ğŸ“Maven í”„ë¡œì íŠ¸ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e7ed873d-ae19-4b21-8e38-34658ca1e111" width="60%"/>

<br>
<br>

#### ğŸ“í†°ìº£ ì›¹ì„œë²„ì— ë°°í¬í•˜ê¸°
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/aed0f6cf-f038-4471-a958-45874d09390c" width="60%"/>

<br>
<br>

#### ğŸ“ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4712b6d1-005f-466c-8209-549839e832e9" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4a3f6d08-65b2-4464-a42f-7f94fc05c067" width="60%"/>

- **Post-build Actions (ë¹Œë“œ í›„ ì¡°ì¹˜)**
    - Deploy war/ear to a container : íŒ¨í‚¤ì§•ëœ íŒŒì¼ì„ ì»¨í…Œì´ë„ˆì— ë°°í¬
    - `*/*.war`: í˜„ì¬ ë””ë ‰í† ë¦¬ í•˜ìœ„ íŒŒì¼ ì¤‘ í™•ì¥ìê°€ war(tomcat ì›¹ì„œë²„ì—ë‹¤ê°€ ë³µì‚¬í•˜ê³ ì í•  ëŒ€ìƒì˜ íŒŒì¼ íŒ¨í„´ì„ ë„£ì„ ê²ƒ)
- **Add Container**
    - ì–´ë– í•œ ì»¨í…Œì´ë„ˆì— ë°°í¬í• ì§€
    - ì½¤ë³´ë°•ìŠ¤ì—ì„œ í†°ì¼“ ì›¹ì„œë²„ ì¤‘ 9ì ëŒ€ ë¦¬ëª¨íŠ¸

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/fff4e5f5-c98a-4edf-bafb-c50f407ba99f" width="60%"/>

- **Credentials**  +add
    - í†°ìº£ ì„œë²„ì— war íŒŒì¼ì„ ë°°í¬í•˜ê¸° ìœ„í•´ì„œëŠ” í†°ìº£ ì„œë²„ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” (Deploy í•  ìˆ˜ ìˆëŠ”) ê¶Œí•œì´ ìˆì–´ì•¼ í•œë‹¤.
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/6c05d091-043e-4d63-a932-f707f18cf96a" width="60%"/>
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/c514bd78-e955-46f9-a513-ce1ad525f95b" width="60%"/><br>
         ğŸ§‘ğŸ»â€ğŸ« Credentials : tomcat ì›¹ì„œë²„ë¥¼ ì„¤ì¹˜í–ˆì„ ë•Œ ìš°ë¦¬ê°€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì ê¶Œí•œì„ ì¶”ê°€í•´ì£¼ëŠ” ë©”ë‰´<br>
        - manager-script : scriptë¥¼ í†µí•´ì„œ ìš°ë¦¬ê°€ í•„ìš”í•œ tomcat ì›¹ì„œë²„ì—ë‹¤ war íŒŒì¼ì„ ë°°í¬í•˜ëŠ” ê¶Œí•œì´ ìˆë‹¤.<br>
        - manager-gui : tomcat ê³„ì •ìœ¼ë¡œ GUI í™”ë©´ì—ì„œ ë°°í¬ì‘ì—…ì„ í•  ìˆ˜ ìˆë‹¤.<br>

<br>
<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/01531625-796c-4c81-be00-6d5a01af0c63" width="60%"/>

- **Tomcat URL**
  - ë³¸ì¸ì˜ ip:8088
  - í˜„ì¬ JenkinsëŠ” Dockerë¡œ ê¸°ë™ ì¤‘ì´ë©° ì™¸ì¥ Tomcatì€ ë¡œì»¬PCë¡œ ê¸°ë™ ì¤‘ì´ë‹¤.
    > ğŸ§‘ğŸ»â€ğŸ« jenkins ìì²´ê°€ 8080ìœ¼ë¡œ ê¸°ë™í•˜ê³  ìˆê¸° ë•Œë¬¸ì— í†°ì¼“ ì„œë²„ëŠ” **8088**ë¡œ ê¸°ë™í•˜ë„ë¡ ì„¤ì •!<br>
     <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/09092938-d2f2-4a8a-b6bf-1a1426b55c59" width="60%"/><br>
    > - 127.0.0.1:8088ë¡œ ì‘ì„±í•œë‹¤ë©´ Jenkinsì—ì„œëŠ” dockerë‚´ë¶€ì˜ 8088ì„ ì°¾ìœ¼ë ¤ê³  ì‹œë„í•˜ê³  ì—†ìœ¼ë¯€ë¡œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê²Œ ëœë‹¤.
    > - ë”°ë¼ì„œ ìš°ë¦¬ê°€ ê°€ì§€ê³  ìˆëŠ” waríŒŒì¼ì„ Jenkinsë¥¼ í†µí•´ì„œ Tomcat ì›¹ì„œë²„ì—ë‹¤ ë°°í¬ë¥¼ í•˜ë ¤ê³  í•˜ë©´ 127.0.0.1 or localhostê°€ ì•„ë‹Œ **MacOS IP**ë¥¼ ì‘ì„±í•´ì¤˜ì•¼í•œë‹¤.

<br>

#### ğŸ“ Tomcat ì„¤ì¹˜

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/c8df9b8a-a03a-4c46-878e-262cb6c0904f" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/51a66c29-f282-408b-a638-30d545320905" width="60%"/>

- Coreì— tar.gz ì„¤ì¹˜

<br>

#### ğŸ“ Tomcat ì‹¤í–‰
```
apache-tomcat-9.0.82 % cd /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82/bin
choihyewon@choehyewon-ui-noteubug bin % ./startup.sh
Using CATALINA_BASE:   /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82
Using CATALINA_HOME:   /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82
Using CATALINA_TMPDIR: /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82/temp
Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk-19.jdk/Contents/Home
Using CLASSPATH:       /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82/bin/bootstrap.jar:/Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82/bin/tomcat-juli.jar
Using CATALINA_OPTS:   
Tomcat started.
```
<br>

### ğŸš¨ì£¼ì˜!!! ìˆ˜ì •ì‚¬í•­
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/aa4693f9-13ef-4bc9-839a-fdaed571bd47" width="60%"/>

- conf - ê°ì¢… ì„¤ì • ë‹´ë‹¹
- webapps - tomcatì´ ê´€ë¦¬í•˜ê³ ì í•˜ëŠ” ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ë“¤ì´ ì €ì¥ëœë‹¤.

<br>

1. <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/ae64161a-918b-488a-95be-2e2079be6d93" width="80%"/>
```xml
<Connector port="8088" protocol="HTTP/1.1"
               connectionTimeout="20000"
               redirectPort="8443"
               maxParameterCount="1000"
               />
```
- 8080ì—ì„œ 8088ë¡œ ë³€ê²½

<br>

2. <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4a70c56d-9ffa-4c21-8d31-47410ee26b07" width="80%"/>
```xml
<!--Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" --> 
```
- ì ‘ì†í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ 127.0.0.1 ë¡œë§Œ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆë‹¤. â†’ ì£¼ì„ìœ¼ë¡œ ë§‰ì•„ì£¼ê¸°!

<br>

3. <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/71194e6e-6fa5-436d-a42a-1c12f2b33a50" width="80%"/>
```xml
<!--Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1" --> 
```
- ìœ„ì™€ ë™ì¼

<br>

4. <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/9798e44a-d8f6-4e14-929d-8c07c09f80f2" width="80%"/>
```xml
<role rolename="manager-gui" />
<role rolename="manager-script" />
<role rolename="manager-jmx" />
<role rolename="manager-status" />
<user username="admin" password="admin"
        roles="manager-gui, manager-script, manager-jmx, manager-status" />
<user username="deployer" password="deployer"
        roles="manager-script" />
<user username="tomcat" password="tomcat"
        roles="manager-gui"/>
```
- ì£¼ì„ í•´ì œí•˜ê¸°

<br>

#### ğŸ“ ë¹Œë“œí•˜ê¸°
- mac ì—ì„œ ê¸°ë™ ì¤‘ì¸ Tomcat > webapps ì— war íŒŒì¼ì´ ë³µì‚¬ë˜ì—ˆë‹¤.<br> (Jenkinsì—ì„œ ë°œìƒí–ˆë˜ hello-world.war íŒŒì¼ì´ Tomcat ì„œë²„ë¡œ ë³µì‚¬ë˜ì—ˆë‹¤.)
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/75b8c2d7-8fd6-4598-a753-5149cdcf6816" width="60%"/>

```
(í†°ì¼“ í™ˆí´ë” ì ‘ì†)
bin % cd /Users/choihyewon/Desktop/Work/apache-tomcat-9.0.82    
apache-tomcat-9.0.82 % ls -al
total 264
drwxr-xr-x@ 17 choihyewon  staff    544 11  6 13:26 .
drwxr-xr-x   4 choihyewon  staff    128 11  6 13:26 ..
-rw-r--r--@  1 choihyewon  staff   8196 11  6 13:27 .DS_Store
-rw-r-----@  1 choihyewon  staff  19992 10 11 22:15 BUILDING.txt
-rw-r-----@  1 choihyewon  staff   6210 10 11 22:15 CONTRIBUTING.md
-rw-r-----@  1 choihyewon  staff  57092 10 11 22:15 LICENSE
-rw-r-----@  1 choihyewon  staff   2333 10 11 22:15 NOTICE
-rw-r-----@  1 choihyewon  staff   3398 10 11 22:15 README.md
-rw-r-----@  1 choihyewon  staff   6901 10 11 22:15 RELEASE-NOTES
-rw-r-----@  1 choihyewon  staff  16505 10 11 22:15 RUNNING.txt
drwxr-x---@ 29 choihyewon  staff    928 11  6 10:05 bin
drwx------@ 13 choihyewon  staff    416 11  6 11:29 conf
drwxr-x---@ 34 choihyewon  staff   1088 11  6 10:05 lib
drwxr-x---@  8 choihyewon  staff    256 11  6 13:00 logs
drwxr-x---@  3 choihyewon  staff     96 11  6 10:05 temp
drwxr-x---@ 10 choihyewon  staff    320 11  6 13:00 webapps
drwxr-x---@  3 choihyewon  staff     96 11  6 13:26 work
apache-tomcat-9.0.82 % cd webapps/ 
webapps % ls -al
total 15696
drwxr-x---@ 10 choihyewon  staff      320 11  6 13:00 .
drwxr-xr-x@ 17 choihyewon  staff      544 11  6 13:26 ..
-rw-r--r--@  1 choihyewon  staff     6148 11  6 11:19 .DS_Store
drwxr-x---@ 13 choihyewon  staff      416 11  6 10:05 ROOT
drwxr-x---@ 61 choihyewon  staff     1952 11  6 10:05 docs
drwxr-x---@  8 choihyewon  staff      256 11  6 10:05 examples
drwxr-x---   4 choihyewon  staff      128 11  6 13:00 hello-world
-rw-r-----   1 choihyewon  staff  8025948 11  6 13:00 hello-world.war
drwxr-x---@  8 choihyewon  staff      256 11  6 11:25 host-manager
drwxr-x---@ 10 choihyewon  staff      320 11  6 11:30 manager
```
<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/79d2a91a-81ec-4b25-b361-1e5e2e4a51fe" width="60%"/>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/8a4b61fc-88d2-487a-9838-13ccd5eaeffd" width="60%"/>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/cf30d5e9-5384-4865-83bd-0cb253470aac" width="60%"/>

<br>
<br>

## 4. PollSCM ì„¤ì •ì„ í†µí•œ ì§€ì†ì ì¸ íŒŒì¼ ì—…ë°ì´íŠ¸
### PollSCM : í´ë§ ì‘ì—…ì„ ì£¼ê¸°ì ìœ¼ë¡œ í•  ìˆ˜ ìˆë‹¤. 
- Project > Configure > Build Triggers(ë¹Œë“œ ìœ ë°œ)
  - Build periodically -> cron job : ì½”ë“œì— ë³€ê²½ì‚¬í•­ì´ ì—†ì–´ë„ ì¼ë‹¨ ë¹Œë“œ
  - Poll SCM -> cron job : ì—…ë°ì´íŠ¸ë¥¼ í•  ë•Œ ì»¤ë°‹ì— ëŒ€í•œ ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ë¹Œë“œ
  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4194009d-a20f-4a04-be39-f717ea0fb6bb" width="60%"/><br>

- ì½”ë“œ ë³€ê²½ í›„ commit&push<br>

  <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/416109ce-d3a8-4b03-8211-d8a4a5caf49f" width="50%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/f1bb95b4-7cab-4d5a-8c21-67aa10e69f95" width="50%"/><br>
<br>

- ê²°ê³¼ : ê¹ƒì— í‘¸ì‹œí•¨ê³¼ ë™ì‹œì— ìë™ ë°°í¬<br>
  > ğŸ§‘ğŸ»â€ğŸ« ë¹Œë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì•˜ëŠ”ë° ì»¤ë°‹ë˜ì–´ ìˆëŠ” ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ì¸ì§€í•´ì„œ ë¹Œë“œê°€ ë¨.<br>
  > ì†ŒìŠ¤ì½”ë“œë¥¼ ë³€ê²½í•œ ë‹¤ìŒ gitì— ì½”ë“œë¥¼ ì˜¬ë¦¼ê³¼ ë™ì‹œì— ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ê°€ ë˜ê³ ,<br> ê·¸ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì™€ì„œ ë¹Œë“œ íŒ¨í‚¤ì§•ì„ í•œ ë‹¤ìŒì— ì„œë²„ì—ë‹¤ ë°°í¬ê¹Œì§€!<br>
  > <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/331d4902-6339-40db-9854-2fa560dba2a3" width="50%"/><br>

<br>

## 5. SSH + Dockerê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ” VM(ì»¨í…Œì´ë„ˆ) ì‚¬ìš©í•˜ê¸°
> ğŸ§‘ğŸ»â€ğŸ« Jenkinsì—ì„œ ë§Œë“¤ì–´ì§„ ê²°ê³¼ì¸ íŒ¨í‚¤ì§•ëœ íŒŒì¼ì„ ë‹¤ë¥¸ ì„œë²„ì— ë³µì‚¬, í˜„ì¬ê¹Œì§€ ë¡œì»¬ì‹œìŠ¤í…œì˜ Tomcatì— ë³µì‚¬í•˜ëŠ” ì‘ì—…ì„ í–ˆìŒ

### í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e4e939f6-29a5-4904-b265-4bb3514d6181" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/8b6068c8-6d06-4cd6-b661-fd7f27143c5f" width="60%"/><br>

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/c7c6f4d6-f88d-402b-80e7-f6726905476a" width="50%"/><img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/938f884f-7c1d-4616-af4e-fad2f8e17511" width="49%"/><br>

- í˜„ì¬ê¹Œì§€ëŠ” Jenkinsì—ì„œ ë§Œë“¤ì–´ì§„ ê²°ê³¼ë¬¼(hello-world.war)ë¥¼ ë¡œì»¬ì˜ Tomcatì— ë³µì‚¬í•˜ì˜€ë‹¤.
- ì´ì œëŠ” ë‹¤ë¥¸ ì„œë²„ì— ê²°ê³¼ë¬¼íŒŒì¼ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
- ë”°ë¼ì„œ ë¡œì»¬ì‹œìŠ¤í…œ ì™¸ì— ë‹¤ë¥¸ ì„œë²„ê°€ í•„ìš”í•˜ë‹¤. ê·¸ë˜ì„œ ë„ì»¤ì— ê°€ìƒì˜ ì„œë²„ë¥¼ ì„¤ì¹˜í•˜ì—¬ ì‚¬ìš©í•  ê²ƒì´ë‹¤.
- ìƒˆë¡­ê²Œ ì¶”ê°€ë˜ëŠ” Dockerì˜ ê°€ìƒ ì„œë²„ Container ì—ëŠ” SSH, ë„ì»¤ ì—”ì§„ì´ í¬í•¨ëœë‹¤.
- ìƒˆë¡­ê²Œ ì„¤ì¹˜ëœ **VM**(ì»¨í…Œì´ë„ˆ-ì´ˆë¡ìƒ‰)ì•ˆì— ë„ì»¤ ì—”ì§„ì„ ì„¤ì¹˜ (vm:ë¦¬ëˆ…ìŠ¤ì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ê°€ìƒ pc )
- Jenkinsì—ì„œ ë§Œë“¤ì–´ì§„ waríŒŒì¼ì„ **SSH** í†µí•´ ì„œë²„ì— ë³µì‚¬
- ë‹¨, ë„ì»¤ì—ì„œ ì‚¬ìš©í•´ì•¼í•˜ë¯€ë¡œ **ì´ë¯¸ì§€**ë¡œ ë§Œë“¤ì–´ì£¼ëŠ” ì‘ì—…ì´ ìˆì–´ì•¼í•œë‹¤.
  - ì°¸ê³ ë¡œ ë„ì»¤ì—ì„œ ë§í•˜ëŠ” ì´ë¯¸ì§€ë€ **ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ë‚´ìš©ì´ í¬í•¨ëœ ë‹¨ì¼í™”ëœ ê²°ê³¼ë¬¼**
  - ìƒíƒœë¥¼ ë°”ê¿€ ìˆ˜ ì—†ëŠ” íŒŒì¼ì´ê¸° ë•Œë¬¸ì— ì´ ë‚´ìš©ì„ ê°–ê³  ìš°ë¦¬ê°€ í•„ìš”ë¡œ í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ì¦‰ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/f2d2d4d6-9cfa-4739-a676-4dbee69ef9d8" width="60%"/><br>
- ë„ì»¤ì—ì„œ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” DokcerFileì´ í•„ìš”í•˜ë‹¤. ì‰½ê²Œë§í•´ waríŒŒì¼ + DockerFile = ì´ë¯¸ì§€
- ì´ë¯¸ì§€ëŠ” **Tomcatì„œë²„**ì™€ **ë³µì‚¬ëœ waríŒŒì¼**ì„ í¬í•¨ë˜ì–´ìˆì„ ê²ƒì´ë‹¤.
- ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ì»¨í…Œì´ë„ˆë¥¼ ì—¬ëŸ¬ê°œ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

<br>

â­ï¸ **Jenkinsì—ì„œ í•´ì•¼í•  ì‘ì—…**
1. ê²°ê³¼íŒŒì¼(war)ì„ SSH ë¥¼ ì´ìš©í•´ì„œ ë³µì‚¬ (ì„œë²„2)
2. ì„œë²„2ë²ˆì—ì„œ DockerFile + *.war ë¥¼ ì´ìš©í•˜ì—¬ Docker Image ìƒì„±(ë¹Œë“œ)
3. Docker Image ë¥¼ ê°€ì§€ê³  ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±

script ì— 1,2,3 ì‘ì—…ì„ í¬í•¨ì‹œì¼œì•¼í•œë‹¤.
<br>

**Dashboard > Jenkins ê´€ë¦¬ > System > Publish over SSH**

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4b7b9d7b-e63a-4728-9cb8-db0940f4751e" width="60%"/><br>
- SSH Servers(ë„ì»¤ ì»¨í…Œì´ë„ˆë¡œ ê¸°ë™ë˜ê³  ìˆëŠ”) ì¶”ê°€ë²„íŠ¼<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/78081fdb-1665-42f3-895a-522d613959f6" width="60%"/><br>

<br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/71e45968-5338-4091-aad2-19fef6670fc6" width="60%"/><br>
- hostname : localhostë¼ê³  í•˜ë©´ jenkins ìê¸° ìì‹ ì„ ë‚˜íƒ€ëƒ„

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/8950bff4-1c0f-407d-87b5-431ac0fbaa68" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/03a82dc3-810e-4358-9f9c-a0a7dbb6f390" width="60%"/><br>
- í…ŒìŠ¤íŠ¸ ì„±ê³µ
  - jenkinsì—ì„œ ë˜ ë‹¤ë¥¸ ë„ì»¤ì— ìˆëŠ” ì„œë²„(SSH)ë¡œ ì ‘ì†ì´ ì„±ê³µí–ˆë‹¤.<br>
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/accb1ed5-6c80-4e1f-828d-3890800deaad" width="60%"/><br>
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/72a67ee0-dd22-40ae-b564-886d52cae2cb" width="60%"/><br>
    <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4b8f207c-03d6-46f7-b973-90a6390c62b0" width="30%"/><br>


<br>

ğŸ“Œ **SSH Server ì„¤ì¹˜**

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a88ac2ce-bfd9-4903-8065-9b8da7041dce" width="30%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/68506243-f5ea-41d4-bd68-46165ce8f30b" width="30%"/><br>
- Apple silicon chipì„ ì‚¬ìš©í•˜ëŠ” MacOSìš© docker ì‹¤ìŠµ ì´ë¯¸ì§€ì…ë‹ˆë‹¤.
  - CentOS
  - SSH server + Docker Engine(ë¦¬ëˆ…ìŠ¤ ê¸°ë°˜)<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e4f6d414-5eec-4b49-b796-3a4ff6db93a6" width="30%"/><br>

<br>

ğŸ“**Docker Server ì™€ SSH ê°€ ì„¤ì¹˜ëœ Docker Image pull**
```
docker pull edowon0623/docker-server:m1
```
```
 ~ % docker pull edowon0623/docker-server:m1
m1: Pulling from edowon0623/docker-server
52f9ef134af7: Pull complete 
b0057b9a5ec7: Pull complete 
5de1b09ce5f0: Pull complete 
220446312972: Pull complete 
3315db72bb66: Pull complete 
d7b146b2846c: Pull complete 
6ad839f282f8: Pull complete 
9a32b78ae1f2: Pull complete 
d27b78b9e37a: Pull complete 
057d0583946b: Pull complete 
92b30088b9f6: Pull complete 
de85a0cecf04: Pull complete 
2722065ffa48: Pull complete 
a3ed95caeb02: Pull complete 
a142c3a5e637: Pull complete 
Digest: sha256:fbed23705537207d8cb8e495a817b27bbe0a94abe4aa078372a5ec2f471b4824
Status: Downloaded newer image for edowon0623/docker-server:m1
docker.io/edowon0623/docker-server:m1

What's Next?
  View summary of image vulnerabilities and recommendations â†’ docker scout quickview edowon0623/docker-server:m1
```  
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/5cdd6380-4fc9-423a-8937-ae04bea81f55" width="60%"/><br>

<br>

ğŸ“**MacOS m1 SSH ì„œë²„ (with ë„ì»¤) ì‹¤í–‰ ëª…ë ¹ì–´**
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4d5f90a8-d4c8-4258-8e10-c2b982befd1a" width="60%"/><br>
```
docker run --privileged --name docker-server -itd -p 10022:22 -p 8081:8080 -e container=docker -v /sys/fs/cgroup:/sys/fs/cgroup:rw --cgroupns=host edowon0623/docker-server:m1 /usr/sbin/init
```
- --privileged : ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ë£¨íŠ¸ ê³„ì •ì„ ê°€ì§€ê³  ì‹¤í–‰í•´ì•¼ ë  ëª‡ëª‡ ëª…ë ¹ì–´ë“¤ ë£¨íŠ¸ ê¶Œí•œ íšë“

```
 ~ % docker ps
CONTAINER ID   IMAGE                         COMMAND                   CREATED              STATUS              PORTS                                              NAMES
33bd1d300805   edowon0623/docker-server:m1   "/sbin/init systemctâ€¦"   About a minute ago   Up About a minute   0.0.0.0:10022->22/tcp, 0.0.0.0:8081->8080/tcp      docker-server
```
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/7845eb8a-ccb9-43e7-a49e-792439c7decc" width="60%"/><br>

<br>

ğŸ“**SSH ì ‘ì†**
```
ssh root@localhost -p 10022
```
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/4b8f207c-03d6-46f7-b973-90a6390c62b0" width="30%"/><br>
```
[root@c6caaa1f3878 ~]# systemctl status docker
-> ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ í„°ë„ë§ í•´ì„œ ë“¤ì–´ì˜¤ê²Œ ë¨!(ê°€ìƒì„œë²„)
-> ê°€ìƒ ì„œë²„ì— jenkinsì—ì„œ ë§Œë“  waríŒŒì¼ì„ ë³µì‚¬í•´ì„œ ë„£ì„ ê²ƒì„!

â— docker.service - Docker Application Container Engine
   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
   Active: inactive (dead)
     Docs: https://docs.docker.com

[root@c6caaa1f3878 ~]# systemctl start docker
[root@c6caaa1f3878 ~]# systemctl status docker
â— docker.service - Docker Application Container Engine
   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
   Active: active (running) since Tue 2023-11-07 13:16:24 UTC; 33min ago
     Docs: https://docs.docker.com
 Main PID: 142 (dockerd)
    Tasks: 9
   Memory: 27.1M
   CGroup: /docker/c6caaa1f3878f770c3028da8883e0331d090901301ff59a6d85fd5fe4480cb6d/system.slice/docker.service
           â””â”€142 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.184955254Z" level=info msg="ClientConn switching balancer to \"pick_first\"" module=grpc
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.185977504Z" level=error msg="Failed to built-in GetDriver graph btrfs /var/lib/docker"
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.187060088Z" level=error msg="failed to mount overlay: invalid argument" storage-driver=overlay2
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.194139088Z" level=info msg="Loading containers: start."
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.269489129Z" level=info msg="Default bridge (docker0) is assigned with an IP address 172.18.0.0/16. Daemon o>
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.315884379Z" level=info msg="Loading containers: done."
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.329227129Z" level=info msg="Docker daemon" commit=a89b842 graphdriver(s)=fuse-overlayfs version=20.10.17
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.329347213Z" level=info msg="Daemon has completed initialization"
Nov 07 13:16:24 c6caaa1f3878 systemd[1]: Started Docker Application Container Engine.
Nov 07 13:16:24 c6caaa1f3878 dockerd[142]: time="2023-11-07T13:16:24.359140880Z" level=info msg="API listen on /var/run/docker.sock"
```
```
[root@c6caaa1f3878 ~]# docker images
REPOSITORY   TAG       IMAGE ID   CREATED   SIZE
[root@c6caaa1f3878 ~]# docker ps -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
```
- ë„ì»¤ ì—”ì§„ì´ ì‘ë™í•˜ëŠ” ë°ì— ë¬¸ì œê°€ ì—†ìŒì„ í™•ì¸í•˜ì˜€ë‹¤!

<br>

### ë„¤ë²ˆì§¸ ì•„ì´í…œ ìƒì„±
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/3c53a4d7-98d4-4533-9919-4f2cc4a17cb0" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/19b303ee-97cf-4960-898d-98f4a85899a4" width="60%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/549559ef-8817-4126-b172-a190bad728ba" width="30%"/><br>

<br>

#### ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/5925f98b-6123-4aa9-a303-563cb28ac6ef" width="30%"/><br>
- Send build artifacts over SSH : ssh ì„œë²„ì— íŒ¨í‚¤ì§• ë˜ì–´ ìˆë˜ ê²°ê³¼ë¬¼ artifactë¥¼ ë³µì‚¬í•˜ê² ë‹¤ëŠ” ì˜µì…˜

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/befbd2eb-f926-4e1a-8114-525f30ca0f2e" width="60%"/><br>
- Source files : ì–´ë– í•œ ëŒ€ìƒì„ ë³µì‚¬í•  ê²ƒì¸ì§€ ì§€ì •
  - target ë°‘ì— ìˆëŠ” .war íŒŒì¼ì´ ì‹¤ì œ ssh ì„œë²„ì— ë³µì‚¬ê°€ ë  ê²ƒì´ë‹¤.
- Remove prefix : ì‚­ì œí•˜ê³ ì í•˜ëŠ” prefix

<br>

#### ì•„ì´í…œ ìƒì„± ì™„ë£Œ
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/6c1db6b1-8fe6-4c97-bee5-290f96d73bfb" width="60%"/><br>

```
(ì»¨í…Œì´ë„ˆ ë‚´ë¶€ íŒŒì¼ ëª©ë¡ í™•ì¸)
[root@c6caaa1f3878 ~]# pwd (í˜„ì¬ ìœ„ì¹˜)
/root
[root@c6caaa1f3878 ~]# ls -l (íŒŒì¼ ëª©ë¡)
total 20
-rw-r--r-- 1 root root  127 Sep  3  2021 Dockerfile
-rw------- 1 root root 2365 Sep 15  2021 anaconda-ks.cfg
-rw-r--r-- 1 root root  608 Sep 15  2021 anaconda-post.log
-rw-r--r-- 1 root root  213 Nov  7 13:14 exit
-rw------- 1 root root 2062 Sep 15  2021 original-ks.cfg 
```

<br>

#### ë¹Œë“œ
ìš°ë¦¬ê°€ ì§€ì •í–ˆë˜ jenkinsì—ì„œ war íŒŒì¼(hello-world.war)ì„ ì§€ì •í–ˆë˜ SSH ì„œë²„ë¡œ **ë³µì‚¬ê¹Œì§€ëŠ”** ëë‹¤.
```
[root@c6caaa1f3878 ~]# ls -l
total 7860
-rw-r--r-- 1 root root     127 Sep  3  2021 Dockerfile
-rw------- 1 root root    2365 Sep 15  2021 anaconda-ks.cfg
-rw-r--r-- 1 root root     608 Sep 15  2021 anaconda-post.log
-rw-r--r-- 1 root root     213 Nov  7 13:14 exit
-rw-r--r-- 1 root root 8025902 Nov  7 16:25 hello-world.war
-rw------- 1 root root    2062 Sep 15  2021 original-ks.cfg
```
```
[root@c6caaa1f3878 ~]# cat Dockerfile (ë„ì»¤ íŒŒì¼ ë‚´ìš© í™•ì¸)
FROM tomcat:9.0

LABEL org.opencontainers.image.authors="edowon0623@gmail.com"

COPY ./hello-world.war (í˜„ì¬ ë””ë ‰í„°ë¦¬ì— ìˆëŠ” waríŒŒì¼ì„) /usr/local/tomcat/webapps (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í†°ì¼“ ë°‘ webapps í´ë”ì— ë³µì‚¬í•´ ì£¼ì„¸ìš”)
```
<br>

> ğŸ§‘ğŸ»â€ğŸ« Jenkinsì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ì „ì— ìš°ë¦¬ê°€ ê°€ì§€ê³  ìˆëŠ” ê°€ìƒ í™˜ê²½ì— ë³µì‚¬ë˜ì–´ ìˆëŠ” war íŒŒì¼ì´ ë„ì»¤ë¥¼ ì´ìš©í•´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²ƒì¸ì§€ í…ŒìŠ¤íŠ¸<br>

ğŸ“ **ì´ë¯¸ì§€ ë¹Œë“œ ëª…ë ¹ì–´(Container ë‚´ì—ì„œ í…ŒìŠ¤íŠ¸)**
```
docker build --tag docker-server -f Dockerfile .
```
```
[root@c6caaa1f3878 ~]# docker build -t docker-server -f Dockerfile .
Sending build context to Docker daemon  8.044MB
Step 1/3 : FROM tomcat:9.0
9.0: Pulling from library/tomcat
895d322e8e59: Pull complete 
69f494a09172: Pull complete 
86b26a5f79e0: Pull complete 
759c5cde3e2f: Pull complete 
9b4da4cf0b7c: Pull complete 
eadc366b3beb: Pull complete 
3460b2103221: Pull complete 
3f063aeb1e53: Pull complete 
Digest: sha256:6ddfc8c16a3f8a1c2c4258d37921e73d0d181b57f79994b5a4eea3a0da8b45d9
Status: Downloaded newer image for tomcat:9.0
 ---> 349050649a53
Step 2/3 : LABEL org.opencontainers.image.authors="edowon0623@gmail.com"
 ---> Running in b03d3d4a7292
Removing intermediate container b03d3d4a7292
 ---> 05312176c95e
Step 3/3 : COPY ./hello-world.war /usr/local/tomcat/webapps
 ---> b50df4e5e451
Successfully built b50df4e5e451
Successfully tagged docker-server:latest
[root@c6caaa1f3878 ~]# docker images
REPOSITORY      TAG       IMAGE ID       CREATED              SIZE
docker-server   latest    b50df4e5e451   About a minute ago   463MB
tomcat          9.0       349050649a53   7 days ago           455MB
```

<br>

ğŸ“ **ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ëª…ë ¹ì–´ (Container ë‚´ì—ì„œ í…ŒìŠ¤íŠ¸)**
```
docker run --privileged  -p 8080:8080 --name mytomcat docker-server:latest 
```
- ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ war íŒŒì¼ì„ mytomcat(/usr/local/tomcat/webapps)ì— ë°°í¬í•˜ë ¤ê³  í•œë‹¤.
```
[root@c6caaa1f3878 ~]# docker ps -a
CONTAINER ID   IMAGE                  COMMAND             CREATED        STATUS                     PORTS     NAMES
fc281db4089b   docker-server:latest   "catalina.sh run"   10 hours ago   Exited (129) 9 hours ago             mytomcat
```

<br>

ğŸ“ **ë„ì»¤ê°€ ì‹¤í–‰ëœ ìƒíƒœì—ì„œ ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì—ì„œ ì ‘ì† í…ŒìŠ¤íŠ¸**

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/a1fb6421-d12b-42eb-a195-c4439db20d19" width="60%"/><br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/80d29a9d-096a-430e-a962-b29299fa27ad" width="60%"/><br>

<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/9731a06c-0c48-4e62-b985-919fbbfbb6d8" width="30%"/><br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/3fda5039-afbf-4d01-9320-7b9ccb48b2f9" width="40%"/><br>
- í†°ì¼“ ë‚´ë¶€ì— ìˆëŠ” ì„œë²„ê°€ ì˜ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸!
- ì •ë¦¬ : ë§¥osì—ì„œ http://localhost:8081 ì„ í˜¸ì¶œí•˜ë©´ ê·¸ ì •ë³´ê°€ ssh ì„œë²„ì— 8080ìœ¼ë¡œ ì—°ê²°ì´ ë˜ê³ , ssh ì„œë²„ì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ” ë„ì»¤ ì—”ì§„ì˜ í†°ì¼“ì— ì—°ê²°ì´ ëœë‹¤.

<br>

### ì‹¤ìŠµ
ìƒˆë¡œìš´ ì•„ì´í…œì„ ë§Œë“¤ê³  ì„¤ì¹˜í•œ SSH ì„œë²„ì—ë‹¤ ì‹¤ì œ ë‚´ê°€ íŒ¨í‚¤ì§•í•œ ê²°ê³¼ë¬¼ì„ ë°°í¬í•´ë³´ì!<br>

> ğŸ§‘ğŸ»â€ğŸ« ë„¤ë²ˆì§¸ í”„ë¡œì íŠ¸ëŠ” ì„¸ë²ˆì§¸ ë§Œë“¤ì—ˆë˜ í”„ë¡œì íŠ¸ì—ì„œ ì¤‘ê°„ ì´í›„ì— íŒ¨í‚¤ì§• ë˜ì–´ìˆëŠ” ê²°ê³¼ë¬¼ì„ ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì— ë°°í¬í•  ê±´ì§€ê°€ ë‹¬ë¼ì§€ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ê·¸ ë¶€ë¶„ë§Œ ë³€ê²½í•  ê²ƒì„<br>
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/78b79fdb-05b0-4daa-b8c7-6234596bc902" width="60%"/><br>
> - ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë°›ì•„ì™€ì„œ ìƒˆë¡œìš´ ë¹Œë“œ ë§Œë“œëŠ” ê³¼ì • ì§€ìš°ê¸°
>- ê¸°ì¡´ì— ë§Œë“¤ì—ˆë˜ ì»¨í…Œì´ë„ˆì— ì§ì ‘ ë°°í¬í•´ì£¼ëŠ” ê¸°ëŠ¥ ëŒ€ì‹ ì— SSHë¥¼ í†µí•´ ìš°ë¦¬ê°€ ë§Œë“¤ì—ˆë˜ ê²°ê³¼ë¬¼ì„ ë³´ë‚´ì£¼ëŠ” ì‘ì—… ì¶”ê°€
>- . : í˜„ì¬ ë””ë ‰í† ë¦¬ê°€ SSHë¡œ ì ‘ì†í–ˆì„ ë•Œ /root â†’ ì—¬ê¸°ì— ìš°ë¦¬ê°€ ì›í–ˆë˜ war íŒŒì¼ì„ ë³µì‚¬í•˜ê² ë‹¤.

<br>

#### ë¹Œë“œ í›„ ì¡°ì¹˜
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/e0119d7a-f2ab-4c72-9182-ba5af72fc953" width="60%"/><br>
- Exec command : ë„ì»¤ë¥¼ ë¹Œë“œí•  ìˆ˜ ìˆëŠ” ì»¤ë©˜ë“œë¥¼ ë„£ì—ˆë‹¤.

```
ì‹¤í–‰ ëª…ë ¹ì–´
docker build --tag=cicd-project -f Dockerfile .(ë§Œë“¤ê³ ì í•˜ëŠ” ì´ë¯¸ì§€ ì´ë¦„ê³¼ íƒœê·¸ ë„¤ì„, ë„ì»¤ íŒŒì¼ì˜ ì´ë¦„)
docker images 
docker image inspect cicd-project:latest
docker run -p 8080:8080 --name mytomcat cicd-project:latest (í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ê°€ì§€ê³  ì»¨í…Œì´ë„ˆ ì‹¤í–‰)
```

> ğŸ§‘ğŸ»â€ğŸ« í•´ë‹¹í•˜ëŠ” ì»¨í…Œì´ë„ˆì— ê°€ì„œ í•´ì•¼ ë  ì‘ì—…ì€ war íŒŒì¼ì´ ë³µì‚¬ê°€ ëìœ¼ë‹ˆ í•´ë‹¹í•˜ëŠ” ì´ë¯¸ì§€ ë§Œë“œëŠ” ì‘ì—…ì„ í•˜ê³ , ë§Œë“¤ì–´ì ¸ ìˆëŠ” ì´ë¯¸ì§€ ê°€ì§€ê³  ì»¨í…Œì´ë„ˆ ìƒì„±í•˜ëŠ” ì‘ì—…ê¹Œì§€ ë„˜ì–´ê°„ë‹¤.<br>
> ë¹Œë“œ ì „ì— ì»¨í…Œì´ë„ˆ, ì´ë¯¸ì§€ ìˆìœ¼ë©´ ì‚­ì œí•´ì£¼ê¸°

```
choihyewon@choehyewon-ui-noteubug ~ % ssh root@localhost -p 10022
root@localhost's password: 
Last login: Wed Nov  8 05:46:13 2023 from 172.17.0.1
[root@c6caaa1f3878 ~]# docker images
Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
[root@c6caaa1f3878 ~]# systemctl status docker
â— docker.service - Docker Application Container Engine
   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)
   Active: inactive (dead)
     Docs: https://docs.docker.com
[root@c6caaa1f3878 ~]# systemctl start docker
[root@c6caaa1f3878 ~]# docker images
REPOSITORY   TAG       IMAGE ID       CREATED      SIZE
tomcat       9.0       349050649a53   8 days ago   455MB
[root@c6caaa1f3878 ~]# docker ps -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
[root@c6caaa1f3878 ~]# ls -l
total 7860
-rw-r--r-- 1 root root     129 Nov  7 16:40 Dockerfile
-rw------- 1 root root    2365 Sep 15  2021 anaconda-ks.cfg
-rw-r--r-- 1 root root     608 Sep 15  2021 anaconda-post.log
-rw-r--r-- 1 root root     213 Nov  7 13:14 exit
-rw-r--r-- 1 root root 8025902 Nov  8 06:27 hello-world.war (ì‚­ì œí•´ì£¼ê¸°)
-rw------- 1 root root    2062 Sep 15  2021 original-ks.cfg
[root@c6caaa1f3878 ~]# rm -rf hello-world.war
[root@c6caaa1f3878 ~]# ls -l
total 20
-rw-r--r-- 1 root root  129 Nov  7 16:40 Dockerfile
-rw------- 1 root root 2365 Sep 15  2021 anaconda-ks.cfg
-rw-r--r-- 1 root root  608 Sep 15  2021 anaconda-post.log
-rw-r--r-- 1 root root  213 Nov  7 13:14 exit
-rw------- 1 root root 2062 Sep 15  2021 original-ks.cfg
```

<br>

#### ë¹Œë“œ
**ê²°ê³¼**
```
[root@c6caaa1f3878 ~]# docker images
REPOSITORY     TAG       IMAGE ID       CREATED         SIZE
cicd-project   latest    9058d2314289   4 minutes ago   463MB
tomcat         9.0       349050649a53   8 days ago      455MB
[root@c6caaa1f3878 ~]# docker ps -a
CONTAINER ID   IMAGE                 COMMAND             CREATED         STATUS         PORTS                    NAMES
26c9941ff913   cicd-project:latest   "catalina.sh run"   4 minutes ago   Up 4 minutes   0.0.0.0:8080->8080/tcp   mytomcat
[root@c6caaa1f3878 ~]# ls -l
total 7860
-rw-r--r-- 1 root root     129 Nov  7 16:40 Dockerfile
-rw------- 1 root root    2365 Sep 15  2021 anaconda-ks.cfg
-rw-r--r-- 1 root root     608 Sep 15  2021 anaconda-post.log
-rw-r--r-- 1 root root     213 Nov  7 13:14 exit
-rw-r--r-- 1 root root 8025902 Nov  8 06:47 hello-world.war
-rw------- 1 root root    2062 Sep 15  2021 original-ks.cfg
```

<br>

> ğŸ§‘ğŸ»â€ğŸ« ì´ì œ Jenkinsì˜ ì‘ì—… ì•„ì´í…œì—ì„œ ë¹Œë“œë¥¼ í•˜ê²Œ ë˜ë©´ gitì—ì„œ ì½”ë“œë¥¼ ê°–ê³  ì˜¨ í›„ í•´ë‹¹í•˜ëŠ” ì½”ë“œë¥¼ ìš°ë¦¬ê°€ ì›í–ˆë˜ ì„œë²„ë¡œ ë³µì‚¬<br>
> ë³µì‚¬ê°€ ëœ ì„œë²„ì—ì„œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì—ˆê³  ì»¨í…Œì´ë„ˆ ìƒì„±í•˜ëŠ” ì‘ì—…ê¹Œì§€ ì™„ë£Œ
> <img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/cf22298a-c276-4231-9542-710e5387271b" width="60%"/><br>
> ì´ë¡œì¨ ë„ì»¤ì— ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ì„œ ë°°í¬í•˜ëŠ” ì‘ì—…ê¹Œì§€ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ì„œ í•´ë´„

<br>

#### ë‚¨ì€ë¬¸ì œ
- ì»¨í…Œì´ë„ˆê°€ ì‘ë™ ì¤‘ì¸ ìƒíƒœ(ì´ë¯¸ì§€ê°€ ìˆëŠ” ìƒíƒœ)ì—ì„œ ë¹Œë“œ ì‹œ ì‹¤íŒ¨
<img src="https://github.com/hyewon218/Building-CI-CD-pipelines-with-Jenkins/assets/126750615/9ba8ff6c-9858-49e5-9c23-40646a98be7a" width="60%"/><br>
- ê°™ì€ ì´ë¦„ìœ¼ë¡œ ë‘ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸
- ìˆ˜ì‘ì—…(ì´ë¯¸ì§€, ì»¨í…Œì´ë„ˆ ì‚­ì œ)í›„ ë‹¤ì‹œ ì‘ë™ì‹œí‚¤ë©´ ì„±ê³µ
  ```
    [root@c6caaa1f3878 ~]# docker ps
    CONTAINER ID   IMAGE          COMMAND             CREATED          STATUS          PORTS                    NAMES
    26c9941ff913   9058d2314289   "catalina.sh run"   42 minutes ago   Up 42 minutes   0.0.0.0:8080->8080/tcp   mytomcat
    [root@c6caaa1f3878 ~]# docker stop mytomcat
    mytomcat
    [root@c6caaa1f3878 ~]# docker rm mytomcat
    mytomcat
    [root@c6caaa1f3878 ~]# docker images
    REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
    <none>       <none>    9058d2314289   43 minutes ago   463MB
    tomcat       9.0       349050649a53   8 days ago       455MB
    [root@c6caaa1f3878 ~]# docker rmi 9058d2314289
    Deleted: sha256:9058d2314289822472b4869b6661e4b5a20bf744cf56b83aa639a1d60a0dcf27
    Deleted: sha256:6efe5b9a7bd76ab4d99ee6ea684de5797dbb24e5fa83d3520343d065c5664da1
    Deleted: sha256:1aaa714be0e96abb515aeda231955452fa7cb48702d63c59cdbbca5a5707744d
    [root@c6caaa1f3878 ~]# docker images  
    REPOSITORY   TAG       IMAGE ID       CREATED      SIZE
    tomcat       9.0       349050649a53   8 days ago   455MB
    [root@c6caaa1f3878 ~]# docker ps
    CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
  ```
<br>

**ìœ„ì™€ ê°™ì€ ë¬¸ì œë¥¼ ìë™í™”í•˜ê¸° ìœ„í•´ IaCë¥¼ ì‚¬ìš©**